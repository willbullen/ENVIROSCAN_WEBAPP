{% extends "layouts/base.html" %}


{% block content %}
<!-- BEGIN #content -->
<div id="content" class="app-content">
	<!-- BEGIN page-header -->
	<div class="d-flex fw-bold small">
		<span class="flex-grow-1">
			<h1 class="page-header">
				MET EIREANN 
			</h1>			
			<p>List widget is created by using existing Bootstrap <code>.list-group</code> component with
				<code>.d-flex</code> and hud utilities css classes.</p>
		</span>
	</div>
	<!-- END page-header -->

	<!-- BEGIN -->
	<!-- BEGIN #listWidget -->
	<div id="listWidget" class="mb-5">
		<div class="card">
			<div class="card-body">
				<div class="row">
					<div class="col-xl-6">
						<div class="text-white text-opacity-50 small mb-2"><b>VALENTIA SITE</b></div>
						<div class="list-group mb-3">
							<!-- BEGIN PICARRO -->
							<div class="list-group-item d-flex align-items-center">
								<div id="Status_PICARRO_G2401_01" class="w-40px h-40px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
									P
								</div>
								<div class="flex-fill px-3">
									<div class="fw-bold">Picarro</div>
									<div class="small text-white text-opacity-50">Last Updated: 1 minute ago</div>
								</div>
								<div class="opacity-10 px-3">
									<span id="Asset_Status_PICARRO_G2401_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">ASSET</span>
									<span id="Node_Status_PICARRO_G2401_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">NODE</span>
									<span id="Server_Status_PICARRO_G2401_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">SERVER</span>
								</div>
								<div class="fs-12px ms-auto">
									<a href="#" class="text-white text-opacity-50" data-bs-toggle="collapse" data-bs-target="#collapseOne">
										<i class="fa fa-plus-circle"></i>
									</a>
								</div>
							</div>
							<!-- END PICARRO -->
							<!-- BEGIN PICARRO DETAILS -->
							<div class="collapse list-group-item" id="collapseOne">
								<div>
									<div class="fw-bold">Picarro Detail</div>
								</div>
							</div>
							<!-- END PICARRO DETAILS -->


							<!-- BEGIN AETHALOMETER -->
							<div class="list-group-item d-flex align-items-center">
								<div id="Status_AETHALOMETER_AE33_01" class="w-40px h-40px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
									A
								</div>
								<div class="flex-fill px-3">
									<div class="fw-bold">Aethalometer</div>
									<div class="small text-white text-opacity-50">Last Updated: 1 minute ago</div>
								</div>
								<div class="opacity-10 px-3">
									<span id="Asset_Status_AETHALOMETER_AE33_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">ASSET</span>
									<span id="Node_Status_AETHALOMETER_AE33_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">NODE</span>
									<span id="Server_Status_AETHALOMETER_AE33_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">SERVER</span>
								</div>
								<div class="dropdown">
									<a href="#" data-bs-toggle="dropdown" class="text-white text-opacity-50"><i class="fa fa-ellipsis-h"></i></a>
									<div class="dropdown-menu dropdown-menu-end">
										<a href="#" class="dropdown-item">Dashboard</a>
										<a href="#" class="dropdown-item">DAQC</a>
										<a href="#" class="dropdown-item">Settings</a>
									</div>
								</div>
							</div>
							<!-- END AETHALOMETER -->
							<!-- BEGIN METEOROLOGY -->
							<div class="list-group-item d-flex align-items-center">
								<div id="Status_METEOROLOGY_01" class="w-40px h-40px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
									M
								</div>
								<div class="flex-fill px-3">
									<div class="fw-bold">Meteorology</div>
									<div class="small text-white text-opacity-50">Last Updated: 1 minute ago</div>
								</div>
								<div class="opacity-10 px-3">
									<span id="Asset_Status_METEOROLOGY_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">ASSET</span>
									<span id="Node_Status_METEOROLOGY_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">NODE</span>
									<span id="Server_Status_METEOROLOGY_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">SERVER</span>
								</div>
								<div class="dropdown">
									<a href="#" data-bs-toggle="dropdown" class="text-white text-opacity-50"><i class="fa fa-ellipsis-h"></i></a>
									<div class="dropdown-menu dropdown-menu-end">
										<a href="../picarro_dash/?id=1" class="dropdown-item">Dashboard</a>
										<a href="../daqc/?id=1" class="dropdown-item">DAQC</a>
										<a href="#" class="dropdown-item">Settings</a>
									</div>
								</div>
							</div>
							<!-- END METEOROLOGY -->
							<!-- BEGIN GENERATOR -->
							<div class="list-group-item d-flex align-items-center">
								<div id="Status_GENERATOR_01" class="w-40px h-40px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
									G
								</div>
								<div class="flex-fill px-3">
									<div class="fw-bold">Generator</div>
									<div class="small text-white text-opacity-50">Last Updated: 1 minute ago</div>
								</div>
								<div class="opacity-10 px-3">
									<span id="Asset_Status_GENERATOR_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">ASSET</span>
									<span id="Node_Status_GENERATOR_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">NODE</span>
									<span id="Server_Status_GENERATOR_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">SERVER</span>
								</div>
								<div class="dropdown">
									<a href="#" data-bs-toggle="dropdown" class="text-white text-opacity-50"><i class="fa fa-ellipsis-h"></i></a>
									<div class="dropdown-menu dropdown-menu-end">
										<a href="../picarro_dash/?id=1" class="dropdown-item">Dashboard</a>
										<a href="../daqc/?id=1" class="dropdown-item">DAQC</a>
										<a href="#" class="dropdown-item">Settings</a>
									</div>
								</div>
							</div>
							<!-- END GENERATOR -->
							<!-- BEGIN UPS -->
							<div class="list-group-item d-flex align-items-center">
								<div id="Status_UPS_01" class="w-40px h-40px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
									U
								</div>
								<div class="flex-fill px-3">
									<div class="fw-bold">UPS</div>
									<div class="small text-white text-opacity-50">Last Updated: 1 minute ago</div>
								</div>
								<div class="opacity-10 px-3">
									<span id="Asset_Status_UPS_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">ASSET</span>
									<span id="Node_Status_UPS_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">NODE</span>
									<span id="Server_Status_UPS_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">SERVER</span>
								</div>
								<div class="dropdown">
									<a href="#" data-bs-toggle="dropdown" class="text-white text-opacity-50"><i class="fa fa-ellipsis-h"></i></a>
									<div class="dropdown-menu dropdown-menu-end">
										<a href="../picarro_dash/?id=1" class="dropdown-item">Dashboard</a>
										<a href="../daqc/?id=1" class="dropdown-item">DAQC</a>
										<a href="#" class="dropdown-item">Settings</a>
									</div>
								</div>
							</div>
							<!-- END UPS -->
							<!-- BEGIN ACSM -->
							<div class="list-group-item d-flex align-items-center">
								<div id="Status_ACSM_01" class="w-40px h-40px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
									A
								</div>
								<div class="flex-fill px-3">
									<div class="fw-bold">ACSM</div>
									<div class="small text-white text-opacity-50">Last Updated: 1 minute ago</div>
								</div>
								<div class="opacity-10 px-3">
									<span id="Asset_Status_ACSM_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">ASSET</span>
									<span id="Node_Status_ACSM_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">NODE</span>
									<span id="Server_Status_ACSM_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">SERVER</span>
								</div>
								<div class="dropdown">
									<a href="#" data-bs-toggle="dropdown" class="text-white text-opacity-50"><i class="fa fa-ellipsis-h"></i></a>
									<div class="dropdown-menu dropdown-menu-end">
										<a href="../picarro_dash/?id=1" class="dropdown-item">Dashboard</a>
										<a href="../daqc/?id=1" class="dropdown-item">DAQC</a>
										<a href="#" class="dropdown-item">Settings</a>
									</div>
								</div>
							</div>
							<!-- END ACSM -->
						</div>

						<div class="text-white text-opacity-50 small mb-2"><b>CAHERSIVEEN SITE</b></div>
						<div class="list-group mb-3">
							<!-- BEGIN NOX -->
							<div class="list-group-item d-flex align-items-center">
								<div id="Status_NOX_01" class="w-40px h-40px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
									N
								</div>
								<div class="flex-fill px-3">
									<div class="fw-bold">NOX</div>
									<div class="small text-white text-opacity-50">Last Updated: 1 minute ago</div>
								</div>
								<div class="opacity-10 px-3">
									<span id="Asset_Status_NOX_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">ASSET</span>
									<span id="Node_Status_NOX_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">NODE</span>
									<span id="Server_Status_NOX_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">SERVER</span>
								</div>
								<div class="dropdown">
									<a href="#" data-bs-toggle="dropdown" class="text-white text-opacity-50"><i class="fa fa-ellipsis-h"></i></a>
									<div class="dropdown-menu dropdown-menu-end">
										<a href="../picarro_dash/?id=1" class="dropdown-item">Dashboard</a>
										<a href="../daqc/?id=1" class="dropdown-item">DAQC</a>
										<a href="#" class="dropdown-item">Settings</a>
									</div>
								</div>
							</div>
							<!-- END NOX -->
							<!-- BEGIN SOX -->
							<div class="list-group-item d-flex align-items-center">
								<div id="Status_SOX_01" class="w-40px h-40px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
									P
								</div>
								<div class="flex-fill px-3">
									<div class="fw-bold">SOX</div>
									<div class="small text-white text-opacity-50">Last Updated: 1 minute ago</div>
								</div>
								<div class="opacity-10 px-3">
									<span id="Asset_Status_SOX_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">ASSET</span>
									<span id="Node_Status_SOX_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">NODE</span>
									<span id="Server_Status_SOX_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">SERVER</span>
								</div>
								<div class="dropdown">
									<a href="#" data-bs-toggle="dropdown" class="text-white text-opacity-50"><i class="fa fa-ellipsis-h"></i></a>
									<div class="dropdown-menu dropdown-menu-end">
										<a href="../picarro_dash/?id=1" class="dropdown-item">Dashboard</a>
										<a href="../daqc/?id=1" class="dropdown-item">DAQC</a>
										<a href="#" class="dropdown-item">Settings</a>
									</div>
								</div>
							</div>
							<!-- END SOX -->
							<!-- BEGIN TUCSON -->
							<div class="list-group-item d-flex align-items-center">
								<div id="Status_TUCSON_STATION_01" class="w-40px h-40px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
									T
								</div>
								<div class="flex-fill px-3">
									<div class="fw-bold">Tucson</div>
									<div class="small text-white text-opacity-50">Last Updated: 1 minute ago</div>
								</div>
								<div class="opacity-10 px-3">
									<span id="Asset_Status_TUCSON_STATION_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">ASSET</span>
									<span id="Node_Status_TUCSON_STATION_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">NODE</span>
									<span id="Server_Status_TUCSON_STATION_01" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">SERVER</span>
								</div>
								<div class="dropdown">
									<a href="#" data-bs-toggle="dropdown" class="text-white text-opacity-50"><i class="fa fa-ellipsis-h"></i></a>
									<div class="dropdown-menu dropdown-menu-end">
										<a href="../picarro_dash/?id=1" class="dropdown-item">Dashboard</a>
										<a href="../daqc/?id=1" class="dropdown-item">DAQC</a>
										<a href="#" class="dropdown-item">Settings</a>
									</div>
								</div>
							</div>
							<!-- END TUCSON -->
							<!-- BEGIN METEOROLOGY -->
							<div class="list-group-item d-flex align-items-center">
								<div id="Status_METEOROLOGY_02" class="w-40px h-40px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
									M
								</div>
								<div class="flex-fill px-3">
									<div class="fw-bold">Meteorology</div>
									<div class="small text-white text-opacity-50">Last Updated: 1 minute ago</div>
								</div>
								<div class="opacity-10 px-3">
									<span id="Asset_Status_METEOROLOGY_02" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">ASSET</span>
									<span id="Node_Status_METEOROLOGY_02" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">NODE</span>
									<span id="Server_Status_METEOROLOGY_02" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">SERVER</span>
								</div>
								<div class="dropdown">
									<a href="#" data-bs-toggle="dropdown" class="text-white text-opacity-50"><i class="fa fa-ellipsis-h"></i></a>
									<div class="dropdown-menu dropdown-menu-end">
										<a href="../picarro_dash/?id=1" class="dropdown-item">Dashboard</a>
										<a href="../daqc/?id=1" class="dropdown-item">DAQC</a>
										<a href="#" class="dropdown-item">Settings</a>
									</div>
								</div>
							</div>
							<!-- END METEOROLOGY -->
							<!-- BEGIN GENERATOR -->
							<div class="list-group-item d-flex align-items-center">
								<div id="Status_GENERATOR_02" class="w-40px h-40px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
									G
								</div>
								<div class="flex-fill px-3">
									<div class="fw-bold">Generator</div>
									<div class="small text-white text-opacity-50">Last Updated: 1 minute ago</div>
								</div>
								<div class="opacity-10 px-3">
									<span id="Asset_Status_GENERATOR_02" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">ASSET</span>
									<span id="Node_Status_GENERATOR_02" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">NODE</span>
									<span id="Server_Status_GENERATOR_02" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">SERVER</span>
								</div>
								<div class="dropdown">
									<a href="#" data-bs-toggle="dropdown" class="text-white text-opacity-50"><i class="fa fa-ellipsis-h"></i></a>
									<div class="dropdown-menu dropdown-menu-end">
										<a href="../picarro_dash/?id=1" class="dropdown-item">Dashboard</a>
										<a href="../daqc/?id=1" class="dropdown-item">DAQC</a>
										<a href="#" class="dropdown-item">Settings</a>
									</div>
								</div>
							</div>
							<!-- END GENERATOR -->
							<!-- BEGIN UPS -->
							<div class="list-group-item d-flex align-items-center">
								<div id="Status_UPS_02" class="w-40px h-40px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
									U
								</div>
								<div class="flex-fill px-3">
									<div class="fw-bold">UPS</div>
									<div class="small text-white text-opacity-50">Last Updated: 1 minute ago</div>
								</div>
								<div class="opacity-10 px-3">
									<span id="Asset_Status_UPS_02" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">ASSET</span>
									<span id="Node_Status_UPS_02" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">NODE</span>
									<span id="Server_Status_UPS_02" class="badge bg-theme" data-bs-toggle="tooltip" data-bs-placement="bottom">SERVER</span>
								</div>
								<div class="dropdown">
									<a href="#" data-bs-toggle="dropdown" class="text-white text-opacity-50"><i class="fa fa-ellipsis-h"></i></a>
									<div class="dropdown-menu dropdown-menu-end">
										<a href="../picarro_dash/?id=1" class="dropdown-item">Dashboard</a>
										<a href="../daqc/?id=1" class="dropdown-item">DAQC</a>
										<a href="#" class="dropdown-item">Settings</a>
									</div>
								</div>
							</div>
							<!-- END UPS -->
						</div>
						
					</div>
					<div class="col-xl-6">

						<div class="text-white text-opacity-50 small mb-2"><b>MAP</b></div>
						<!-- BEGIN map -->
						<div class="map-container">
							<div id="siteMap"></div>
						</div>
						<!-- END map -->
						
					</div>
				</div>
			</div>
			<div class="card-arrow">
				<div class="card-arrow-top-left"></div>
				<div class="card-arrow-top-right"></div>
				<div class="card-arrow-bottom-left"></div>
				<div class="card-arrow-bottom-right"></div>
			</div>
		</div>
	</div>
	<!-- END -->

</div>
<!-- END #content -->
{% endblock content %}


<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<script>

	function setAssetStatus(data, element_id) {
		element_id = '#Asset_Status_' + data.Node_ID
		if (data.Asset_Status == 1) {
			$(element_id).addClass('bg-danger');
			$(element_id).attr('title', data.Asset_Status_Description);
		} else {
			$(element_id).removeClass('bg-danger');
		}
	}

	function setNodeStatus(data) {
		element_id = '#Node_Status_' + data.Node_ID
		if (data.Node_Status == 1) {
			$(element_id).addClass('bg-danger');
			$(element_id).attr('title', data.Asset_Status_Description);
		} else {
			$(element_id).removeClass('bg-danger');
		}
	}

	function setServerStatus(data) {
		element_id = '#Server_Status_' + data.Node_ID
		if (data.Server_Status == 1) {
			$(element_id).addClass('bg-danger');
			$(element_id).attr('title', data.Asset_Status_Description);
		} else {
			$(element_id).removeClass('bg-danger');
		}
	}

	function setOverallStatus(data) {
		element_id = '#Status_' + data.Node_ID
		if (data.Asset_Status == 1 || data.Server_Status == 1 || data.Node_Status == 1) {
			$(element_id).removeClass('bg-gradient-cyan-blue');
			$(element_id).addClass('bg-gradient-red');
			$(element_id).attr('title', 'ERROR');
		} else {
			$(element_id).removeClass('bg-gradient-red');
			$(element_id).addClass('bg-gradient-cyan-blue');
			$(element_id).attr('title', 'OK');
		}
	}

	// -- GET OVERALL STATUS 
	var ajax_call = function() {
		$.ajax({
			type: 'GET',
			url: '../nodes/node/',
			headers: {
				"Authorization": "Basic " + btoa("admin" + ":" + "will1977"),
				'Accept' : 'application/json'
			},
			success: function(data) {
				console.log(data)
				$.each(data['results'], function(i, asset) {
					console.log(asset.Node_ID)
					setAssetStatus(asset)
					setNodeStatus(asset)
					setServerStatus(asset)
					setOverallStatus(asset)
					balena_data = get_node_data(asset.Node_Device_ID)
				});				
			}
		});
	};

	var interval = 60000; // 60 secs
	setInterval(ajax_call, interval);

	function get_node_data(uuid) {
		auth_token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTQ0NDM3LCJ1c2VybmFtZSI6ImdoX3dpbGxidWxsZW4iLCJlbWFpbCI6IndpbGxpYW1idWxsZW5AZ21haWwuY29tIiwiY3JlYXRlZF9hdCI6IjIwMjAtMDEtMjlUMTY6MjY6MjMuMTgwWiIsImp3dF9zZWNyZXQiOiJEMklEQlBRUVJEWFRKTVUyQlJTM0hBR1BMSk9SWTM2NyIsImhhc19kaXNhYmxlZF9uZXdzbGV0dGVyIjpmYWxzZSwiZmlyc3RfbmFtZSI6IldpbGxpYW0iLCJsYXN0X25hbWUiOiJCdWxsZW4iLCJhY2NvdW50X3R5cGUiOiJwZXJzb25hbCIsInNvY2lhbF9zZXJ2aWNlX2FjY291bnQiOlt7InByb3ZpZGVyIjoiZ2l0aHViIiwiZGlzcGxheV9uYW1lIjoid2lsbGJ1bGxlbiJ9XSwiY29tcGFueSI6IkVudmlyb3NjYW4gSW9UIiwiaGFzUGFzc3dvcmRTZXQiOnRydWUsIm5lZWRzUGFzc3dvcmRSZXNldCI6ZmFsc2UsInB1YmxpY19rZXkiOnRydWUsImZlYXR1cmVzIjpbXSwiaW50ZXJjb21Vc2VyTmFtZSI6ImdoX3dpbGxidWxsZW4iLCJpbnRlcmNvbVVzZXJIYXNoIjoiOTExZWRjMmVmOWNmZTY3ZDY5ZmRhMDg0YjkyN2UwZDVkNzQxODE3YWZiZjA0ODliYmU4ZTVmNjNiNGY1ZDQwMiIsInBlcm1pc3Npb25zIjpbXSwiYXV0aFRpbWUiOjE2NDk4NDQ2MTY2MDcsImlzX3ZlcmlmaWVkIjp0cnVlLCJtdXN0X2JlX3ZlcmlmaWVkIjpmYWxzZSwiYWN0b3IiOjQyNzU4NDUsImlhdCI6MTY1MDQ3NDUzOCwiZXhwIjoxNjUxMDc5MzM4fQ.ZRSJrQzNlcHM7YXOuH5hneEf7PDt4gJ7xIF8YGrXvPU'
		//uuid = '1cbccd93410c800062b0f9e3160e33e4'
		balena_data = []
		$.ajax({
			type: 'GET',
			url: "https://api.balena-cloud.com/v6/device?\$filter=uuid%20eq%20'" + uuid + "'", 
			headers: {
				"Authorization": "Bearer " + auth_token,
				'Accept' : 'application/json'
			},
			success: function(data) {
				console.log(data)
				balena_data = data				
			}
		});
		return balena_data
	}





	var startWebSocket = function () {
		var soxSocket;
		var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
		var ws_path = ws_scheme + '://' + window.location.host + '/status/';
		soxSocket = new WebSocket(ws_path);    

		soxSocket.onmessage = function (e) {
			ws_Data = JSON.parse(e.data).message;
		};

		soxSocket.onclose = function (e) {
			console.log('Socket is closed. Reconnect will be attempted in 1 second.', e.reason);
		};

		soxSocket.onerror = function (err) {
			console.error(err);
		};
	};
	



	
	var streamsData = []

	var renderMaps = function () {

		$('#siteMap').dxVectorMap({
			// [minLongitude, maxLatitude, maxLongitude, minLatitude]
			size: {
				height: 700,
			},
			bounds: [-12, 55, -5, 51],
			maxZoomFactor: 1000,
			background: {
				color: 'transparent',
				borderColor: 'transparent',
			},
			layers: [{
				dataSource: mapData
			}, {
				type: 'marker',
				elementType: 'image',
				dataField: 'url',
				size: 51,
				label: {
					dataField: 'text',
					font: {
						size: 14,
					},
				},
				//dataSource: equipmentData,
			}, {
				name: 'water',
				dataSource: streamsData,
				//colorGroupingField: 'tag',
				//colorGroups: [0, 1, 2],
				//palette: ['#3c20c8', '#d82020'],
				//borderColor: 'none',
				hoverEnabled: false,
			}],
			legends: [{
				font: {
					size: 14,
				},
				horizontalAlignment: 'right',
				verticalAlignment: 'top',
				customizeText() {
					if (this.color === '#3c20c8') {
						return 'Cold';
					}
					return 'Warm';
				},
				source: {
					layer: 'water',
					grouping: 'color'
				},
			}],
		});

	};

	/* Controller
	------------------------------------------------ */
	$(document).ready(function () {

		renderMaps();
		startWebSocket();
		ajax_call();
		//initialSetup();

		$(document).on('theme-reload', function () {
			renderMaps();
		});

	});
</script>

{% endblock javascripts %}