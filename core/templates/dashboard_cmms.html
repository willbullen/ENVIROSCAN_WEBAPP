{% extends "layouts/base.html" %}


{% block content %}
<!-- BEGIN #content -->
<div id="content" class="app-content">
	<div class="d-flex align-items-center mb-md-3 mb-2">
		<div class="flex-fill">
			<h1 class="page-header mb-0">
				Maintenance Management System
			</h1>
		</div>
		<div class="ms-auto">
			<a href="#modalAddTask" data-bs-toggle="modal" class="btn btn-outline-theme"><i
					class="fa fa-plus-circle me-1"></i> Add Task</a>
		</div>
	</div>

	<div class="mb-md-4 mb-3 d-md-flex">
		<div class="dropdown-toggle">
			<a href="#" data-bs-toggle="dropdown" class="text-white text-opacity-75 text-decoration-none"><i
					class="far fa-folder fa-fw fa-lg text-theme me-1"></i> All Assets</a>
			<div class="dropdown-menu">
				<a href="#" class="dropdown-item"><i class="far fa-folder fa-fw fa-lg text-theme me-1"></i> Picarro</a>
				<a href="#" class="dropdown-item"><i class="far fa-folder fa-fw fa-lg text-theme me-1"></i>
					Aethalometer</a>
				<a href="#" class="dropdown-item"><i class="far fa-folder fa-fw fa-lg text-theme me-1"></i> NOX</a>
				<a href="#" class="dropdown-item"><i class="far fa-folder fa-fw fa-lg text-theme me-1"></i> SOX</a>
				<a href="#" class="dropdown-item"><i class="far fa-folder fa-fw fa-lg text-theme me-1"></i>
					Autosonde</a>
				<a href="#" class="dropdown-item"><i class="far fa-folder fa-fw fa-lg text-theme me-1"></i> Tucson</a>
				<a href="#" class="dropdown-item"><i class="far fa-folder fa-fw fa-lg text-theme me-1"></i>
					Generator</a>
				<a href="#" class="dropdown-item"><i class="far fa-folder fa-fw fa-lg text-theme me-1"></i> UPS</a>
			</div>
		</div>
		<div class="ms-md-4 mt-md-0 mt-2"><i class="fa fa-code-branch fa-fw fa-lg me-1 text-indigo"></i> 5 Open Tasks
		</div>
		<div class="ms-md-4 mt-md-0 mt-2"><i class="far fa-clock fa-fw fa-lg me-1 text-red"></i> 4 In Progress</div>
		<div class="ms-md-4 mt-md-0 mt-2"><i class="fa fa-users-cog fa-fw fa-lg me-1 text-theme"></i> 13 Completed Tasks
		</div>
	</div>

	<!-- BEGIN row -->
	<div class="row">
		<!-- BEGIN col-4 -->
		<div class="col-xl-4 col-lg-6">
			<!-- BEGIN card -->
			<div class="card mb-3">
				<!-- BEGIN card-header -->
				<div class="card-header d-flex align-items-center bg-white bg-opacity-15">
					<span class="flex-grow-1 fw-400">Open Tasks ({{ open_jobs.count }})</span>
					<a href="#" class="text-white text-opacity-50 text-decoration-none me-3"><i
							class="fa fa-fw fa-redo"></i></a>
					<a href="#" class="text-white text-opacity-50 text-decoration-none"><i
							class="fa fa-fw fa-trash"></i></a>
				</div>
				<!-- END card-header -->
				<!-- BEGIN list-group -->
				<div class="list-group list-group-flush">




					{% for job in open_jobs %}
					<!-- BEGIN list-group-item -->
					<div class="list-group-item d-flex px-3">
						<div class="me-3 pt-1">
							<i class="fa fa-tools text-red fa-fw fa-lg"></i>
						</div>
						<div class="flex-fill">
							<div class="fw-400">{{ job.job_title }}</div>
							<div class="small text-white text-opacity-75">{{ job.job_description }}</div>
							<div class="small text-white text-opacity-50 mb-2">#{{ job.job_id }} opened by
								{{ job.job_author }} on {{ job.job_create_date }}</div>
							<div>
								<span class="badge border border-pink text-pink">doc</span>
								<span class="badge border border-theme text-theme">att</span>
								<span class="badge border border-indigo text-indigo">sop</span>
							</div>
							<hr class="my-3" />
							<div class="d-flex align-items-center mb-2">
								<div class="fw-400 me-2">
									Task ({{ job.task_completed }}/{{ job.task_total }})
								</div>
								<div>
									<a href="#" class="text-white text-opacity-50" data-bs-toggle="collapse" data-bs-target="#todoBoard_{{ job.job_id }}">
										<i class="fa fa-plus-circle"></i>
									</a>
								</div>
								<div class="progress progress-xs w-100px me-2 ms-auto" style="height: 6px;">
									<div id="pb_task_{{ job.job_id }}" class="progress-bar progress-bar-striped bg-theme" style="width: 66%;"></div>
								</div>
								<div class="fs-12px">{{ job.task_completed_pecent }}%</div>
							</div>
							<div class="form-group mb-0 small">
								<div class="collapse show" id="todoBoard_{{ job.job_id }}">
									{% for task in job.tasks %}
									<div class="form-check">
										<input type="checkbox" class="form-check-input" id="customCheck1" {% if task.task_status %} checked {% endif %} />
										<label class="form-check-label" for="customCheck1">{{ task.task_title }}</label>
									</div>
									{% endfor %}
								</div>
							</div>
						</div>
					</div>
					<!-- END list-group-item -->
					{% endfor %}




					
				</div>
				<!-- END list-group -->
				<!-- BEGIN card-arrow -->
				<div class="card-arrow">
					<div class="card-arrow-top-left"></div>
					<div class="card-arrow-top-right"></div>
					<div class="card-arrow-bottom-left"></div>
					<div class="card-arrow-bottom-right"></div>
				</div>
				<!-- END card-arrow -->
			</div>
			<!-- END card -->
		</div>
		<!-- END col-4 -->
		<!-- BEGIN col-4 -->
		<div class="col-xl-4 col-lg-6">
			<!-- BEGIN card -->
			<div class="card mb-3">
				<!-- BEGIN card-header -->
				<div class="card-header d-flex align-items-center bg-white bg-opacity-15">
					<span class="flex-grow-1 fw-400">In Progress (2)</span>
					<a href="#" class="text-white text-opacity-50 text-decoration-none me-3"><i
							class="fa fa-fw fa-redo"></i></a>
					<a href="#" class="text-white text-opacity-50 text-decoration-none"><i
							class="fa fa-fw fa-trash"></i></a>
				</div>
				<!-- END card-header -->
				<!-- BEGIN list-group -->
				<div class="list-group list-group-flush">
					<!-- BEGIN list-group-item -->
					<div class="list-group-item d-flex px-3">
						<div class="me-3 pt-1">
							<i class="fa fa-tools text-white text-opacity-50 fa-fw fa-lg"></i>
						</div>
						<div class="flex-fill">
							<div class="fw-400 lh-20">HTML5 flexbox old browser compatibility</div>
							<div class="small text-white text-opacity-50 mb-2">#29982 handled by Sean</div>
							<div class="mb-1">
								<span class="badge border border-indigo text-indigo">enhancement</span>
							</div>
							<hr class="mt-15px mb-15px" />
							<div class="d-flex align-items-center mb-2">
								<div class="fw-400 me-2">
									Task (1/2)
								</div>
								<div>
									<a href="#" class="text-white text-opacity-50" data-bs-toggle="collapse"
										data-bs-target="#inProgressBoard">
										<i class="fa fa-plus-circle"></i>
									</a>
								</div>
								<div class="progress progress-xs w-100px me-2 ms-auto" style="height: 6px;">
									<div class="progress-bar progress-bar-striped bg-warning" style="width: 50%;"></div>
								</div>
								<div class="fs-12px">50%</div>
							</div>
							<div class="form-group mb-1">
								<div class="collapse show" id="inProgressBoard">
									<div class="form-check mb-2px">
										<input type="checkbox" class="form-check-input" id="customCheck4" checked />
										<label class="form-check-label small" for="customCheck4">check all browser
											compatibility for HTML5 flexbox</label>
									</div>
									<div class="form-check mb-2px">
										<input type="checkbox" class="form-check-input" id="customCheck5" />
										<label class="form-check-label small" for="customCheck5">fallback integration by
											using other display property</label>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- END list-group-item -->
					<!-- BEGIN list-group-item -->
					<div class="list-group-item d-flex px-3">
						<div class="me-3 pt-1">
							<i class="fa fa-bug text-danger fa-fw fa-lg"></i>
						</div>
						<div class="flex-fill">
							<div class="fw-400">Mobile app autoclose on iOS</div>
							<div class="text-white text-opacity-50 mb-2">#29953 handled by Ken</div>
							<div class="mb-1">
								<span class="badge border border-gray-300 text-white text-opacity-50">issue</span>
								<span class="badge border border-danger text-danger">bug</span>
							</div>
							<hr class="mt-15px mb-15px" />
							<div class="d-flex align-items-center mb-2">
								<div class="fw-400 me-2">
									Task (0/1)
								</div>
								<div>
									<a href="#" class="text-white text-opacity-50" data-bs-toggle="collapse"
										data-bs-target="#inProgress2Board">
										<i class="fa fa-plus-circle"></i>
									</a>
								</div>
								<div class="progress progress-xs w-100px me-2 ms-auto" style="height: 6px;">
									<div class="progress-bar progress-bar-striped bg-danger" style="width: 5%;"></div>
								</div>
								<div class="fs-12px">0%</div>
							</div>
							<div class="form-group mb-1">
								<div class="collapse show" id="inProgress2Board">
									<div class="form-check mb-2px">
										<input type="checkbox" class="form-check-input" id="customCheck6" />
										<label class="form-check-label small" for="customCheck6">debug and fix mobile
											auto close while using GPS issue</label>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- END list-group-item -->
				</div>
				<!-- END list-group -->
				<!-- BEGIN card-arrow -->
				<div class="card-arrow">
					<div class="card-arrow-top-left"></div>
					<div class="card-arrow-top-right"></div>
					<div class="card-arrow-bottom-left"></div>
					<div class="card-arrow-bottom-right"></div>
				</div>
				<!-- END card-arrow -->
			</div>
			<!-- END card -->
		</div>
		<!-- END col-4 -->
		<!-- BEGIN col-4 -->
		<div class="col-xl-4 col-lg-6">
			<!-- BEGIN card -->
			<div class="card mb-3">
				<!-- BEGIN card-header -->
				<div class="card-header d-flex align-items-center bg-white bg-opacity-15">
					<span class="flex-grow-1 fw-400">Done (1)</span>
					<a href="#" class="text-white text-opacity-50 text-decoration-none me-3"><i
							class="fa fa-fw fa-redo"></i></a>
					<a href="#" class="text-white text-opacity-50 text-decoration-none"><i
							class="fa fa-fw fa-trash"></i></a>
				</div>
				<!-- END card-header -->
				<!-- BEGIN list-group -->
				<div class="list-group list-group-flush">
					<!-- BEGIN list-group-item -->
					<div class="list-group-item d-flex px-3">
						<div class="me-3 pt-1">
							<i class="far fa-check-circle text-success fa-fw fa-lg"></i>
						</div>
						<div class="flex-fill">
							<div class="fw-400">React version missing daterangepicker</div>
							<div class="small text-white text-opacity-50 mb-2">#29930 closed yesterday by Sean</div>
							<div class="mb-1">
								<span class="badge border border-gray-300 text-gray-300">build</span>
								<span class="badge border border-success text-success">feature</span>
							</div>

							<hr class="my-3" />
							<div class="d-flex align-items-center mb-2">
								<div class="fw-400 me-2">
									Task (3/3)
								</div>
								<div>
									<a href="#" class="text-white text-opacity-50" data-bs-toggle="collapse"
										data-bs-target="#completedBoard">
										<i class="fa fa-plus-circle"></i>
									</a>
								</div>
								<div class="progress progress-xs w-100px me-2 ms-auto" style="height: 6px;">
									<div class="progress-bar progress-bar-striped bg-success" style="width: 100%;">
									</div>
								</div>
								<div class="fs-12px">100%</div>
							</div>
							<div class="form-group mb-1">
								<div class="collapse show" id="completedBoard">
									<div class="form-check mb-2px">
										<input type="checkbox" class="form-check-input" id="customCheck7" checked />
										<label class="form-check-label small" for="customCheck7">install
											react-daterangepicker</label>
									</div>
									<div class="form-check mb-2px">
										<input type="checkbox" class="form-check-input" id="customCheck8" checked />
										<label class="form-check-label small" for="customCheck8">customize ui with
											scss</label>
									</div>
									<div class="form-check mb-2px">
										<input type="checkbox" class="form-check-input" id="customCheck9" checked />
										<label class="form-check-label small" for="customCheck9">backend integration for
											data filter with daterange input</label>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- END list-group-item -->
				</div>
				<!-- END list-group -->
				<!-- BEGIN card-arrow -->
				<div class="card-arrow">
					<div class="card-arrow-top-left"></div>
					<div class="card-arrow-top-right"></div>
					<div class="card-arrow-bottom-left"></div>
					<div class="card-arrow-bottom-right"></div>
				</div>
				<!-- END card-arrow -->
			</div>
			<!-- END card -->
		</div>
		<!-- END col-4 -->
		<!-- BEGIN col-4 -->
	</div>
	<!-- END row -->






	<!-- BEGIN modal -->
	<form method="POST" enctype="multipart/form-data">
		<div class="modal fade" id="modalAddTask">
			<div class="modal-dialog">
				<div class="modal-content">
					{% csrf_token %}
					{{ job_form.Author }}
					<div class="modal-header">
						<h5 class="modal-title">Add Task</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
					<div class="modal-body">
						<div class="mb-3">
							<label class="form-label">Asset</label>
							{{job_form.Node_ID}}
						</div>
						<div class="mb-3">
							<label class="form-label">Title</label>
							{{job_form.Job_Title}}
						</div>
						<div class="mb-3">
							<label class="form-label">Description</label>
							{{job_form.Job_Description}}
						</div>
						<div class="mb-3">
							<label class="form-label">Job Status</label>
							{{job_form.Job_Status}}
						</div>
						<div class="mb-3">
							<label class="form-label">Start Date</label>
							<div class="input-group">
								{{job_form.Job_Start_Date}}
								<label class="input-group-text" for="datepicker">
									<i class="fa fa-calendar"></i>
								</label>
							</div>
						</div>
						<div class="mb-3">
							<label class="form-label">End Date</label>
							<div class="input-group">
								{{job_form.Job_End_Date}}
								<label class="input-group-text" for="datepicker">
									<i class="fa fa-calendar"></i>
								</label>
							</div>
						</div>
						<div class="mb-3">
							<label class="form-label">Type</label>
							{{job_form.Job_Type}}
						</div>
						<div class="mb-3">
							<label class="form-label">Priority</label>
							{{job_form.Job_Priority}}
						</div>
						<div class="mb-3">
							<label class="form-label">Schedule Type</label>
							{{job_form.Job_Schedule_Type}}
						</div>
						<div class="mb-3">
							<label class="form-label">Schedule Period</label>
							{{job_form.Job_Schedule_Period}}
						</div>
						<div class="mb-3">
							<label class="form-label">Schedule Period Value</label>
							{{job_form.Job_Schedule_Period_Value}}
						</div>
						<div class="mb-3">
							<label class="form-label">Completed Date</label>
							<div class="input-group">
								{{job_form.Job_Completed_Date}}
								<label class="input-group-text" for="datepicker">
									<i class="fa fa-calendar"></i>
								</label>
							</div>
						</div>
						<div class="mb-3">
							<label class="form-label">Completed Comments</label>
							{{job_form.Job_Completed_Comments}}
						</div>
						{{ tasks_formset.management_form }}
						{% for task in tasks_formset %}
						<div class="mb-3">
							<label class="form-label">Task</label>
							<div class="input-group">
								{{task.Job_Task_Title}}
								<label class="input-group-text">
									<i class="fa fa-plus-square add-form-row"></i>
								</label>
							</div>						
						</div>
						{% endfor %}
					</div>
					<div class="modal-footer">
						<a href="#" class="btn btn-outline-default" data-bs-dismiss="modal">Cancel</a>
						<button type="submit" class="btn btn-outline-theme">Create</button>
					</div>
				</div>
			</div>
		</div>
	</form>
	<!-- END modal -->






</div>
<!-- END #content -->
{% endblock content %}



<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<script type="text/javascript">
	'{% for job in open_jobs %}'
	$('#pb_task_{{ job.job_id }}').attr('style', 'width: {{ job.task_completed_pecent }}%');
	'{% endfor %}'

	$('#datepicker').datepicker({
		autoclose: true
	});

	function updateElementIndex(el, prefix, ndx) {
		var id_regex = new RegExp('(' + prefix + '-\\d+)');
		var replacement = prefix + '-' + ndx;
		if ($(el).attr("for")) $(el).attr("for", $(el).attr("for").replace(id_regex, replacement));
		if (el.id) el.id = el.id.replace(id_regex, replacement);
		if (el.name) el.name = el.name.replace(id_regex, replacement);
	}

	function cloneMore(selector, prefix) {
		var newElement = $(selector).clone(true);
		var total = $('#id_' + prefix + '-TOTAL_FORMS').val();
		newElement.find(':input:not([type=button]):not([type=submit]):not([type=reset])').each(function() {
			var name = $(this).attr('name')
			if(name) {
				name = name.replace('-' + (total-1) + '-', '-' + total + '-');
				var id = 'id_' + name;
				$(this).attr({'name': name, 'id': id}).val('').removeAttr('checked');
			}
		});
		newElement.find('label').each(function() {
			var forValue = $(this).attr('for');
			if (forValue) {
			forValue = forValue.replace('-' + (total-1) + '-', '-' + total + '-');
			$(this).attr({'for': forValue});
			}
		});
		total++;
		$('#id_' + prefix + '-TOTAL_FORMS').val(total);
		$(selector).after(newElement);
		var conditionRow = $('.form-row:not(:last)');
		conditionRow.find('.btn.add-form-row')
		.removeClass('btn-success').addClass('btn-danger')
		.removeClass('add-form-row').addClass('remove-form-row')
		.html('-');
		return false;
	}

	function deleteForm(prefix, btn) {
		var total = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
		if (total > 1){
			btn.closest('.form-row').remove();
			var forms = $('.form-row');
			$('#id_' + prefix + '-TOTAL_FORMS').val(forms.length);
			for (var i=0, formCount=forms.length; i<formCount; i++) {
				$(forms.get(i)).find(':input').each(function() {
					updateElementIndex(this, prefix, i);
				});
			}
		}
		return false;
	}

	$(document).on('click', '.add-form-row', function(e){
		e.preventDefault();
		cloneMore('.form-row:last', 'job_form');
		return false;
	});

	$(document).on('click', '.remove-form-row', function(e){
		e.preventDefault();
		deleteForm('job_form', $(this));
		return false;
	});

</script>

{% endblock javascripts %}