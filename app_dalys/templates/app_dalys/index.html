{% extends "app_dalys/layouts/base.html" %}


{% block content %}
<!-- BEGIN #content -->
<div id="content" class="app-content">
	<!-- BEGIN page-header -->
	<div class="d-flex fw-bold small">
		<span class="flex-grow-1">
			<h1 class="page-header">
				<i class="bi bi-power"></i> Dalys Power
			</h1>
			<div class="text-white small mb-2"><b></b></div>
		</span>
	</div>
	<!-- END page-header -->

	<!-- BEGIN -->
	<!-- BEGIN #listWidget -->
	<div id="listWidget" class="mb-5">
		<div class="card">
			<div class="card-body">
				<div class="row">
					<div class="col-xl-6">

						<!-- BEGIN SUPPLY -->
						<div class="text-white small mb-2"><b>SUPPLY</b></div>
						<div class="list-group mb-3">							
						{% for node in node_list_supply %}
							<!-- BEGIN NODE -->
							<input type="hidden" id="hidden_Node_Status_{{ node.id }}" value="0">
							<input type="hidden" id="hidden_Node_Status_{{ node.id }}" value="0">
							<div class="list-group-item d-flex align-items-center">
								<a href="#" class="text-white text-opacity-50" data-bs-toggle="collapse" data-bs-target="#collapse_{{ node.id }}" id="#go_map_{{ node.id }}">
									<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
										{{ node.Name|make_list|first }}
									</div>
								</a>
								<div class="flex-fill px-3">									
									<a href="#" class="text-white" data-bs-toggle="collapse" data-bs-target="#collapse_{{ node.id }}">							
										<div class="fw-bold">{{ node.Name }}</div>
									</a>
								</div>								

								<!-- <div class="flex-fill px-3">
									<div class="small text-white text-opacity-50">Last Updated: {{ node.Last_Updated|timesince }}</div>
								</div> -->

								<div class="opacity-10 px-3">
									<div class="fw-bold"><span id="value_main_{{ node.id }}">0</span> kW</div>
								</div>

								<div class="opacity-10 px-3">
									<span id="Node_Status_{{ node.id }}" class="badge bg-theme" data-bs-toggle="tooltip">M</span>
									<span id="Node_Status_{{ node.id }}" class="badge bg-theme" data-bs-toggle="tooltip">N</span>
								</div>
							</div>
							<!-- END NODE -->

							<!-- BEGIN NODE DETAILS -->
							<div class="collapse list-group-item" id="collapse_{{ node.id }}">

								<!-- BEGIN nav-tabs -->
								<ul class="nav nav-tabs nav-tabs">
									<li class="nav-item me-3"><a href="#home_{{ node.id }}" class="nav-link active" data-bs-toggle="tab">Data</a></li>
									<li class="nav-item me-3"><a href="#details_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Details</a></li>
									<li class="nav-item me-3"><a href="#logs_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Logs</a></li>
									<li class="nav-item me-3"><a href="#settings_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Settings</a></li>
								</ul>
								<!-- END nav-tabs -->

								<!-- BEGIN tab-content -->
								<div class="tab-content pt-1">
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade show active" id="home_{{ node.id }}">
										<!-- BEGIN TOOLBAR -->
										<div id="node_toolbar_{{ node.id }}"></div>
										<!-- END TOOLBAR -->
										<!-- BEGIN row -->
										<div class="row">
											<div class="col-9">												
												<!-- BEGIN CHART -->
												<div class="pt-1 flex-1">
													<div id="node_chart_{{ node.id }}" class="pt-1 flex-1"></div>
													<div id="node_chart_polar_{{ node.id }}" class="pt-1 flex-1"></div>												
												</div>
												<!-- END CHART -->
											</div>
											<div class="col-3">
												<!-- BEGIN REAL POWER -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														REAL POWER (kW)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="real_power_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="real_power_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="real_power_info_{{ node.id }}">@ 0% of 600 kW.</span>
													</div>
												</div>
												<!-- END REAL POWER -->
												<!-- BEGIN APPAR POWER -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														APPAR POWER (kW)
													</div>													
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="apparent_power_value_{{ node.id }}">0</span></h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="apparent_power_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="apparent_power_info_{{ node.id }}">@ 0% of 600 kW.</span>
													</div>
												</div>
												<!-- END APPAR POWER -->
												<!-- BEGIN IRMS -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														IRMS (A)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="irms_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="irms_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="irms_info_{{ node.id }}">@ 0% of 200 A.</span>
													</div>
												</div>
												<!-- END IRMS -->
												<!-- BEGIN VRMS -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														VRMS (V)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="vrms_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="vrms_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="vrms_info_{{ node.id }}">@ 0% 250 V.</span>
													</div>
												</div>
												<!-- END VRMS -->
												<!-- BEGIN POWER FACTOR -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														POWER FACTOR
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="power_factor_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="power_factor_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="power_factor_info_{{ node.id }}">@ 0%.</span>
													</div>
												</div>
												<!-- END POWER FACTOR -->
											</div>
										</div>
										<!-- END row -->
									</div>
									<!-- END tab-pane -->
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade" id="details_{{ node.id }}">

										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												START OF LOGGING
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Date }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												START INDEX
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Index }} kW
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												TOTAL CONSUMPTION
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Index }} kW
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												PULSE UNIT MEASUREMENT
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Pulse_Unit_Measurement }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												PULSE UNIT VALUE
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Pulse_Unit_Value }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												LOCATION LAT
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Lat }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												LOCATION LNG
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Lng }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												NODE TYPE
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Type }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												REGION
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Region }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												CATEGORY
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Category }}
											</div>
										</div>
										<!-- END DETAILS ROW -->

									</div>
									<!-- END tab-pane -->
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade" id="logs_{{ node.id }}">
										<!-- BEGIN DATATABLE -->
										<div class="pt-2 align-items-center">
											<table id="log2_{{ node.id }}"></table>
										</div>
										<!-- END DATATABLE -->
									</div>
									<!-- END tab-pane -->

									<!-- BEGIN SETTINGS -->
									<div class="tab-pane fade" id="settings_{{ node.id }}">
										<!-- BEGIN DATATABLE -->
										<div class="pt-2 align-items-center">
											<!-- BEGIN #notifications -->
											<div id="notifications" class="mb-5">
												<h6><i class="far fa-bell fa-fw text-theme"></i> Notifications</h6>
												<p>Enable or disable what notifications you want to receive.</p>
												<div class="card">
													<div class="list-group list-group-flush">
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Comments</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Tags</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw me-1"></i> Disabled
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Reminders</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, Email, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>New orders</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, Email, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
													</div>
													<div class="card-arrow">
														<div class="card-arrow-top-left"></div>
														<div class="card-arrow-top-right"></div>
														<div class="card-arrow-bottom-left"></div>
														<div class="card-arrow-bottom-right"></div>
													</div>
												</div>
											</div>
											<!-- END #notifications -->
										</div>
										<!-- END DATATABLE -->
									</div>
									<!-- END SETTINGS -->

								</div>
								<!-- END tab-content -->
								
							</div>
							<!-- END NODE DETAILS -->
						{% endfor %}
						</div>
						<!-- END SUPPLY -->



						<!-- BEGIN consumer -->
						<div class="text-white small mb-2"><b>CONSUMERS</b></div>
						<div class="list-group mb-3">							
						{% for node in node_list_consumer %}
							<!-- BEGIN NODE -->
							<input type="hidden" id="hidden_Node_Status_{{ node.id }}" value="0">
							<input type="hidden" id="hidden_Node_Status_{{ node.id }}" value="0">
							<div class="list-group-item d-flex align-items-center">
								<a href="#" class="text-white text-opacity-50" data-bs-toggle="collapse" data-bs-target="#collapse_{{ node.id }}" id="#go_map_{{ node.id }}">
									<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
										{{ node.Name|make_list|first }}
									</div>
								</a>
								<div class="flex-fill px-3">									
									<a href="#" class="text-white" data-bs-toggle="collapse" data-bs-target="#collapse_{{ node.id }}">							
										<div class="fw-bold">{{ node.Name }}</div>
									</a>
								</div>								

								<!-- <div class="flex-fill px-3">
									<div class="small text-white text-opacity-50">Last Updated: {{ node.Last_Updated|timesince }}</div>
								</div> -->

								<div class="opacity-10 px-3">
									<div class="fw-bold"><span id="value_main_{{ node.id }}">0</span> kW</div>
								</div>

								<div class="opacity-10 px-3">
									<span id="Node_Status_{{ node.id }}" class="badge bg-theme" data-bs-toggle="tooltip">M</span>
									<span id="Node_Status_{{ node.id }}" class="badge bg-theme" data-bs-toggle="tooltip">N</span>
								</div>
							</div>
							<!-- END NODE -->

							<!-- BEGIN NODE DETAILS -->
							<div class="collapse list-group-item" id="collapse_{{ node.id }}">

								<!-- BEGIN nav-tabs -->
								<ul class="nav nav-tabs nav-tabs">
									<li class="nav-item me-3"><a href="#home_{{ node.id }}" class="nav-link active" data-bs-toggle="tab">Data</a></li>
									<li class="nav-item me-3"><a href="#details_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Details</a></li>
									<li class="nav-item me-3"><a href="#logs_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Logs</a></li>
									<li class="nav-item me-3"><a href="#settings_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Settings</a></li>
								</ul>
								<!-- END nav-tabs -->

								<!-- BEGIN tab-content -->
								<div class="tab-content pt-1">
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade show active" id="home_{{ node.id }}">
										<!-- BEGIN TOOLBAR -->
										<div id="node_toolbar_{{ node.id }}"></div>
										<!-- END TOOLBAR -->
										<!-- BEGIN row -->
										<div class="row">
											<div class="col-9">												
												<!-- BEGIN CHART -->
												<div class="pt-1 flex-1">
													<div id="node_chart_{{ node.id }}" class="pt-1 flex-1"></div>
													<div id="node_chart_polar_{{ node.id }}" class="pt-1 flex-1"></div>												
												</div>
												<!-- END CHART -->
											</div>
											<div class="col-3">
												<!-- BEGIN REAL POWER -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														REAL POWER (kW)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="real_power_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="real_power_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="real_power_info_{{ node.id }}">@ 0% of 600 kW.</span>
													</div>
												</div>
												<!-- END REAL POWER -->
												<!-- BEGIN APPAR POWER -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														APPAR POWER (kW)
													</div>													
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="apparent_power_value_{{ node.id }}">0</span></h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="apparent_power_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="apparent_power_info_{{ node.id }}">@ 0% of 600 kW.</span>
													</div>
												</div>
												<!-- END APPAR POWER -->
												<!-- BEGIN IRMS -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														IRMS (A)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="irms_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="irms_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="irms_info_{{ node.id }}">@ 0% of 200 A.</span>
													</div>
												</div>
												<!-- END IRMS -->
												<!-- BEGIN VRMS -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														VRMS (V)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="vrms_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="vrms_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="vrms_info_{{ node.id }}">@ 0% 250 V.</span>
													</div>
												</div>
												<!-- END VRMS -->
												<!-- BEGIN POWER FACTOR -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														POWER FACTOR
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="power_factor_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="power_factor_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="power_factor_info_{{ node.id }}">@ 0%.</span>
													</div>
												</div>
												<!-- END POWER FACTOR -->
											</div>
										</div>
										<!-- END row -->
									</div>
									<!-- END tab-pane -->
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade" id="details_{{ node.id }}">

										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												START OF LOGGING
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Date }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												START INDEX
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Index }} kW
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												TOTAL CONSUMPTION
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Index }} kW
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												PULSE UNIT MEASUREMENT
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Pulse_Unit_Measurement }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												PULSE UNIT VALUE
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Pulse_Unit_Value }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												LOCATION LAT
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Lat }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												LOCATION LNG
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Lng }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												NODE TYPE
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Type }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												REGION
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Region }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												CATEGORY
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Category }}
											</div>
										</div>
										<!-- END DETAILS ROW -->

									</div>
									<!-- END tab-pane -->
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade" id="logs_{{ node.id }}">
										<!-- BEGIN DATATABLE -->
										<div class="pt-2 align-items-center">
											<table id="log2_{{ node.id }}"></table>
										</div>
										<!-- END DATATABLE -->
									</div>
									<!-- END tab-pane -->

									<!-- BEGIN SETTINGS -->
									<div class="tab-pane fade" id="settings_{{ node.id }}">
										<!-- BEGIN DATATABLE -->
										<div class="pt-2 align-items-center">
											<!-- BEGIN #notifications -->
											<div id="notifications" class="mb-5">
												<h6><i class="far fa-bell fa-fw text-theme"></i> Notifications</h6>
												<p>Enable or disable what notifications you want to receive.</p>
												<div class="card">
													<div class="list-group list-group-flush">
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Comments</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Tags</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw me-1"></i> Disabled
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Reminders</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, Email, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>New orders</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, Email, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
													</div>
													<div class="card-arrow">
														<div class="card-arrow-top-left"></div>
														<div class="card-arrow-top-right"></div>
														<div class="card-arrow-bottom-left"></div>
														<div class="card-arrow-bottom-right"></div>
													</div>
												</div>
											</div>
											<!-- END #notifications -->
										</div>
										<!-- END DATATABLE -->
									</div>
									<!-- END SETTINGS -->

								</div>
								<!-- END tab-content -->
								
							</div>
							<!-- END NODE DETAILS -->
						{% endfor %}
						</div>
						<!-- END consumer -->





						<!-- BEGIN waste -->
						<div class="text-white small mb-2"><b>DISTRIBUTION</b></div>
						<div class="list-group mb-3">							
						{% for node in node_list_distribution %}
							<!-- BEGIN NODE -->
							<input type="hidden" id="hidden_Node_Status_{{ node.id }}" value="0">
							<input type="hidden" id="hidden_Node_Status_{{ node.id }}" value="0">
							<div class="list-group-item d-flex align-items-center">
								<a href="#" class="text-white text-opacity-50" data-bs-toggle="collapse" data-bs-target="#collapse_{{ node.id }}" id="#go_map_{{ node.id }}">
									<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
										{{ node.Name|make_list|first }}
									</div>
								</a>
								<div class="flex-fill px-3">									
									<a href="#" class="text-white" data-bs-toggle="collapse" data-bs-target="#collapse_{{ node.id }}">							
										<div class="fw-bold">{{ node.Name }}</div>
									</a>
								</div>								

								<!-- <div class="flex-fill px-3">
									<div class="small text-white text-opacity-50">Last Updated: {{ node.Last_Updated|timesince }}</div>
								</div> -->

								<div class="opacity-10 px-3">
									<div class="fw-bold"><span id="value_main_{{ node.id }}">0</span> kW</div>
								</div>

								<div class="opacity-10 px-3">
									<span id="Node_Status_{{ node.id }}" class="badge bg-theme" data-bs-toggle="tooltip">M</span>
									<span id="Node_Status_{{ node.id }}" class="badge bg-theme" data-bs-toggle="tooltip">N</span>
								</div>
							</div>
							<!-- END NODE -->

							<!-- BEGIN NODE DETAILS -->
							<div class="collapse list-group-item" id="collapse_{{ node.id }}">

								<!-- BEGIN nav-tabs -->
								<ul class="nav nav-tabs nav-tabs">
									<li class="nav-item me-3"><a href="#home_{{ node.id }}" class="nav-link active" data-bs-toggle="tab">Data</a></li>
									<li class="nav-item me-3"><a href="#details_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Details</a></li>
									<li class="nav-item me-3"><a href="#logs_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Logs</a></li>
									<li class="nav-item me-3"><a href="#settings_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Settings</a></li>
								</ul>
								<!-- END nav-tabs -->

								<!-- BEGIN tab-content -->
								<div class="tab-content pt-1">
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade show active" id="home_{{ node.id }}">
										<!-- BEGIN TOOLBAR -->
										<div id="node_toolbar_{{ node.id }}"></div>
										<!-- END TOOLBAR -->
										<!-- BEGIN row -->
										<div class="row">
											<div class="col-9">												
												<!-- BEGIN CHART -->
												<div class="pt-1 flex-1">
													<div id="node_chart_{{ node.id }}" class="pt-1 flex-1"></div>
													<div id="node_chart_polar_{{ node.id }}" class="pt-1 flex-1"></div>												
												</div>
												<!-- END CHART -->
											</div>
											<div class="col-3">
												<!-- BEGIN REAL POWER -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														REAL POWER (kW)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="real_power_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="real_power_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="real_power_info_{{ node.id }}">@ 0% of 600 kW.</span>
													</div>
												</div>
												<!-- END REAL POWER -->
												<!-- BEGIN APPAR POWER -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														APPAR POWER (kW)
													</div>													
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="apparent_power_value_{{ node.id }}">0</span></h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="apparent_power_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="apparent_power_info_{{ node.id }}">@ 0% of 600 kW.</span>
													</div>
												</div>
												<!-- END APPAR POWER -->
												<!-- BEGIN IRMS -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														IRMS (A)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="irms_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="irms_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="irms_info_{{ node.id }}">@ 0% of 200 A.</span>
													</div>
												</div>
												<!-- END IRMS -->
												<!-- BEGIN VRMS -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														VRMS (V)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="vrms_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="vrms_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="vrms_info_{{ node.id }}">@ 0% 250 V.</span>
													</div>
												</div>
												<!-- END VRMS -->
												<!-- BEGIN POWER FACTOR -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														POWER FACTOR
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="power_factor_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="power_factor_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="power_factor_info_{{ node.id }}">@ 0%.</span>
													</div>
												</div>
												<!-- END POWER FACTOR -->
											</div>
										</div>
										<!-- END row -->
									</div>
									<!-- END tab-pane -->
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade" id="details_{{ node.id }}">

										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												START OF LOGGING
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Date }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												START INDEX
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Index }} kW
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												TOTAL CONSUMPTION
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Index }} kW
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												PULSE UNIT MEASUREMENT
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Pulse_Unit_Measurement }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												PULSE UNIT VALUE
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Pulse_Unit_Value }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												LOCATION LAT
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Lat }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												LOCATION LNG
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Lng }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												NODE TYPE
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Type }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												REGION
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Region }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												CATEGORY
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Category }}
											</div>
										</div>
										<!-- END DETAILS ROW -->

									</div>
									<!-- END tab-pane -->
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade" id="logs_{{ node.id }}">
										<!-- BEGIN DATATABLE -->
										<div class="pt-2 align-items-center">
											<table id="log2_{{ node.id }}"></table>
										</div>
										<!-- END DATATABLE -->
									</div>
									<!-- END tab-pane -->

									<!-- BEGIN SETTINGS -->
									<div class="tab-pane fade" id="settings_{{ node.id }}">
										<!-- BEGIN DATATABLE -->
										<div class="pt-2 align-items-center">
											<!-- BEGIN #notifications -->
											<div id="notifications" class="mb-5">
												<h6><i class="far fa-bell fa-fw text-theme"></i> Notifications</h6>
												<p>Enable or disable what notifications you want to receive.</p>
												<div class="card">
													<div class="list-group list-group-flush">
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Comments</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Tags</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw me-1"></i> Disabled
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Reminders</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, Email, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>New orders</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, Email, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
													</div>
													<div class="card-arrow">
														<div class="card-arrow-top-left"></div>
														<div class="card-arrow-top-right"></div>
														<div class="card-arrow-bottom-left"></div>
														<div class="card-arrow-bottom-right"></div>
													</div>
												</div>
											</div>
											<!-- END #notifications -->
										</div>
										<!-- END DATATABLE -->
									</div>
									<!-- END SETTINGS -->

								</div>
								<!-- END tab-content -->
								
							</div>
							<!-- END NODE DETAILS -->
						{% endfor %}
						</div>
						<!-- END waste -->








					</div>
					<div class="col-xl-6">

						<!-- BEGIN NAV-TABS -->
						<ul id="tabs" class="nav nav-tabs nav-tabs">
							<li class="nav-item me-3"><a href="#reporting" class="nav-link active" data-bs-toggle="tab">Reporting</a></li>
							<li class="nav-item me-3"><a href="#data_analysis" class="nav-link" data-bs-toggle="tab">Data Analysis</a></li>
							<li class="nav-item me-3"><a href="#map" class="nav-link" data-bs-toggle="tab">Map</a></li>
							<!-- <li class="nav-item me-3"><a href="#schematics" class="nav-link" data-bs-toggle="tab">Schematics</a></li> -->							
						</ul>
						<!-- END NAV-TABS -->

						<!-- BEGIN tab-content -->
						<div class="tab-content">
							<!-- BEGIN TAB-PANE -->
							<div class="tab-pane fade" id="map">
								<!-- BEGIN TOOLBAR -->
								<div class="pt-1 mb-1" id="map_toolbar"></div>
								<!-- END TOOLBAR -->
								<!-- BEGIN MAP -->
								<div class="pt-1 mb-1" id="siteMap"></div>
								<!-- END MAP -->
							</div>
							<!-- END TAB-PANE -->

							<!-- BEGIN TAB-PANE
							<div class="tab-pane fade" id="schematics">
								<div id="schematics_toolbar"></div>
							</div>
							END TAB-PANE -->

							<!-- BEGIN TAB-PANE -->
							<div class="tab-pane fade" id="data_analysis">
								<!-- BEGIN TOOLBAR -->
								<div class="pt-1 mb-1" id="data_analysis_toolbar"></div>
								<!-- END TOOLBAR -->
								<!-- BEGIN CHART -->
								<div class="pt-1 mb-1" id="data_analysis_chart"></div>
								<!-- END CHART -->
								<!-- BEGIN RANGE -->
								<div class="pt-1 mb-1" id="data_analysis_range"></div>
								<!-- END RANGE -->
							</div>
							<!-- END TAB-PANE -->

							<!-- BEGIN TAB-PANE -->
							<div class="tab-pane fade show active" id="reporting">
								<!-- BEGIN TOOLBAR -->
								<div class="pt-1 mb-1" id="reporting_toolbar"></div>
								<!-- END TOOLBAR -->
								<div class="pt-1 mb-1">
									<p>Totals for a <span id="report_period"></span> day period from <span id="report_from"></span> to the <span id="report_to"></span>, a total of <span id="report_not_nodeed"></span> m3 of supply power was not nodeed. The waste power total for this period was <span id="report_waste"></span> m3.</p>
								</div>
								<!-- BEGIN PIE -->
								<div class="pt-1 mb-1" id="reporting_pie"></div>
								<!-- END PIE -->
								<!-- BEGIN PIE -->
								<div class="pt-1 mb-1" id="reporting_bar"></div>
								<!-- END PIE -->
								<!-- BEGIN GAUGE -->
								<div class="pt-1 mb-1" id="reporting_gauge"></div>
								<!-- END GAUGE -->
								<!-- BEGIN PIE -->
								<div class="pt-1 mb-1" id="reporting_ledger"></div>
								<!-- END PIE -->
							</div>
							<!-- END TAB-PANE -->
						</div>
						<!-- END tab-content -->						
					</div>
				</div>
			</div>
			<div class="card-arrow">
				<div class="card-arrow-top-left"></div>
				<div class="card-arrow-top-right"></div>
				<div class="card-arrow-bottom-left"></div>
				<div class="card-arrow-bottom-right"></div>
			</div>
		</div>
	</div>
	<!-- END -->


</div>
<!-- END #content -->
{% endblock content %}


<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<script>
	// -- GET OVERALL STATUS 
	var markersData = []
	var newMarker = {}
	var icon = ''
	var ajax_call = function() {
		$.ajax({
			type: 'GET',
			url: '../dalys/nodes/list/',
			headers: {
				"Authorization": "Basic " + btoa("admin" + ":" + "will1977"),
				'Accept' : 'application/json'
			},
			success: function(data) {
				
				$.each(data['Data'], function(i, node) {
					// CREATE MAP MARKERS
					if (node.Node_Status == 1) {icon = '/static/assets/img/map/error_marker.png'} else {icon = '/static/assets/img/map/ok_marker.png'}					
					newMarker = {
						location: {
							lat: node.Lat, 
							lng: node.Lng
						},
						tooltip: {
							text: node.Name,
						},
						iconSrc: icon,
					}
					markersData.push(newMarker)					

					// SET STATUS 
					//console.log(node.Name + ': ' + parseInt(Math.abs(new Date()-new Date(node.Last_Updated)) / (1000 * 60)))
					if (parseInt(Math.abs(new Date()-new Date(node.Last_Updated)) / (1000 * 60)) > 2) {
						$('#Node_Status_' + node.id).addClass('bg-danger');
						$('#Node_Status_' + node.id).attr('title', 'Last time data updated was too long.');
						$("#hidden_Node_Status_" + node.id).val('1');
					} else {
						$('#Node_Status_' + node.id).removeClass('bg-danger');
						$("#hidden_Node_Status_" + node.id).val('0');
					}

					// SET VALUES
					set_text(node.id, node.history);

					// SET MAP MARKERS
					set_map_markers(node);

					// SET STATUS MARKERS
					set_status_markers(node);	

				});
				$("#siteMap").dxMap({
					//zoom: 5,
					markers: markersData
				});
			}
		});
	};	

	function create_log_datatable(id) {
		
		// LOG		
		var dataGrid = $('#log2_' + id).dxDataGrid({
			//dataSource: data,
			keyExpr: 'ID',
			showColumnLines: false,
			showRowLines: true,
			rowAlternationEnabled: false,
			showBorders: true,
			paging: {
				pageSize: 8,
			},
			pager: {
				visible: true,
				allowedPageSizes: [5, 10, 'all'],
				showPageSizeSelector: true,
				showInfo: true,
				showNavigationButtons: true,
			},
			columns: [
				{
					title: "DATE TIME",
					dataField: 'Data_DateTime',
				}, {
					title: "L1",
					dataField: 'AppaPower_L1',
					width: 100,
				}, {
					title: "L2",
					dataField: 'AppaPower_L2',
					width: 100,
				}, {
					title: "L3",
					dataField: 'AppaPower_L3',
					width: 100,
				},
			],
		});
	}
	
	function create_charts(id) {
		// CREATE SERIES
		var series = [
			{
				type: 'spline',
				name: 'L1',
				valueField: 'L1',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			},{
				type: 'spline',
				name: 'L2',
				valueField: 'L2',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			},{
				type: 'spline',
				name: 'L3',
				valueField: 'L3',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			}
			//,{
			//	type: 'spline',
			//	name: 'Baseline',
			//	valueField: 'Baseline',
			//	argumentField: "Data_DateTime",
			//	argumentType: "datetime",
			//}
		];
		// CREATE POLAR CHART
		var polar = $('#node_chart_polar_' + id).dxPolarChart({
			palette: 'red',
			commonSeriesSettings: {
				point: {
					visible: false,
				},
			},
			loadingIndicator: {
				enabled: true
			},
			size: {
				height: 300,
			},
			series: [
			{
				type: 'line',
				name: 'L1',
				valueField: 'L1',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			},{
				type: 'line',
				name: 'L2',
				valueField: 'L2',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			},{
				type: 'line',
				name: 'L3',
				valueField: 'L3',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			}//,{
			//	type: 'line',
			//	name: 'Baseline',
			//	valueField: 'Baseline',
			//	argumentField: "Data_DateTime",
			//	argumentType: "datetime",
			//}
		],
			argumentAxis: {
				inverted: false,
				startAngle: 0,
				tickInterval: 'hour',
				period: 'day',
			},
			tooltip: {
				enabled: true,
				shared: true,
				argumentFormat: "shortDateShortTime",
				contentTemplate: function (pointInfo, element) {
					var print = function (label, value) {
						var span = $("<span>", {
							"class": "tooltip-label",
							text: label
						});
						element.append($("<div>", {
							text: value
						}).prepend(span));
					};

					var powerData = {};
					powerData.Data = pointInfo.points[0].point.data;

					print("", powerData.Data.Data_DateTime);
					print("L1: ", powerData.Data.AppaPower_L1.toFixed(3));
					print("L2: ", powerData.Data.AppaPower_L2.toFixed(3));
					print("L3: ", powerData.Data.AppaPower_L3.toFixed(3));
					//print("Baseline: ", powerData.Data.Baseline.toFixed(3));
				},
			},
			legend: {
				verticalAlignment: 'top',
				horizontalAlignment: 'right',
				hoverMode: 'excludePoints',
			}
		});

		// CREATE BAR CHART
		var chart = $('#node_chart_' + id).dxChart({
			palette: 'red',
			commonSeriesSettings: {
				point: {
					visible: false,
				},
			},
			size: {
				height: 360,
			},
			loadingIndicator: {
				enabled: true
			},
			argumentAxis: {
				argumentType: "datetime",
				label: {
					format: "shortDateShortTime"
				},
				valueMarginsEnabled: false,
				discreteAxisDivisionMode: 'crossLabels',
				grid: {
					visible: true,
				},
			},
			series: series,
			tooltip: {
				enabled: true,
			},
			legend: {
				verticalAlignment: 'top',
				horizontalAlignment: 'center',
				hoverMode: 'excludePoints',
			},
			crosshair: {
				enabled: true,
				color: '#949494',
				width: 1,
				dashStyle: 'dot',
				label: {
					visible: true,
					backgroundColor: '#949494',
					font: {
					color: '#fff',
					size: 12,
					},
				},
			},
			export: {
				enabled: false,
			},
			onPointClick: function (e) {
				var point = e.target;
				if (point.isSelected()) {
					point.clearSelection();
				} else {
					point.select();					
				}
			}
		});		
	}

	function getPercentage(act, max) {
		return (act / max) * 100;
	}

	// CREATE TOOL BARS
	function create_tool_bars() {
		// CREATE  TOOL BARS
		var toolbar = $('#_toolbar').dxToolbar({
			items: [

			],
		});
		// CREATE MAP TOOL BARS
		var toolbar = $('#map_toolbar').dxToolbar({
			items: [
			{
					location: 'before',
					widget: 'dxButton',
					locateInMenu: 'auto',
					options: {
						icon: 'refresh',
						onClick() {
							DevExpress.ui.notify('Refresh button has been clicked!');
						},
					},
				}, {
					location: 'after',
					widget: 'dxButton',
					locateInMenu: 'auto',
					options: {
						icon: 'plus',
						onClick() {
							DevExpress.ui.notify('Add button has been clicked!');
						},
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Save',
						onClick() {
							DevExpress.ui.notify('Save option has been clicked!');
						},
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Print',
						onClick() {
							DevExpress.ui.notify('Print option has been clicked!');
						},
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Settings',
						onClick() {
							DevExpress.ui.notify('Settings option has been clicked!');
						},
					},
				},
			],
		});
		// CREATE SCHEMATIC TOOL BARS
		var toolbar = $('#schematics_toolbar').dxToolbar({
			items: [
			{
					location: 'before',
					widget: 'dxButton',
					locateInMenu: 'auto',
					options: {
						icon: 'refresh',
						onClick() {
							DevExpress.ui.notify('Refresh button has been clicked!');
						},
					},
				}, {
					location: 'after',
					widget: 'dxButton',
					locateInMenu: 'auto',
					options: {
						icon: 'plus',
						onClick() {
							DevExpress.ui.notify('Add button has been clicked!');
						},
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Save',
						onClick() {
							DevExpress.ui.notify('Save option has been clicked!');
						},
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Print',
						onClick() {
							DevExpress.ui.notify('Print option has been clicked!');
						},
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Settings',
						onClick() {
							DevExpress.ui.notify('Settings option has been clicked!');
						},
					},
				},
			],
		});				
	}

	// CREATE MAPS
	var renderMaps = function () {
		var siteMap = $('#siteMap').dxMap({
			center: [51.88328620951812, -8.511571884155275],
			zoom: 16.5,
			height: 560,
			width: '100%',
			provider: 'bing',
			controls: true,
			apiKey: {
			// Specify your API keys for each map provider:
			// bing: "YOUR_BING_MAPS_API_KEY",
			},
			type: 'hybrid',
    		markers: markersData,
			mapOnClick: function (e) {
				var point = e.target;
			},
		}).dxMap('instance');
	};
	
	// GET DATA
	function reviver_1(key, value) {
		if (key === 'Data_DateTime' || key === 'Start_Date') {
			return new Date(value);
		}
		if (key === 'history' || key === 'logs') {
			JSON.parse(JSON.stringify(value), reviver_2);
		}
		return value;
	}

	function reviver_2(key, value) {
		if (key === 'Data_DateTime') {
			return new Date(value);
		}
		return value;
	}	

	// SET UP PAGE, CREATE ALL CONTROLS
	function page_setup() {
		// CREATE
		$.each(node_list_data, function(i, node) {
			// CREATE CHARTS
			create_charts(node.id);
			$("#node_chart_" + node.id).show();
			$("#node_chart_polar_" + node.id).hide();
			// CREATE LOG TABLE
			create_log_datatable(node.id);			
			// CREATE NODE TOOL BAR
			create_node_tool_bars(node);
		});
		// CREATE MAP
		renderMaps();
		// CREATE TOOLBARS
		create_tool_bars();
	}

	// CREATE TOOL BARS BY ID
	function create_node_tool_bars(node) {
		// CREATE  TOOL BARS
		var toolbar = $('#node_toolbar_' + node.id).dxToolbar({
			items: [
				{
					location: 'before',
					widget: 'dxButton',
					locateInMenu: 'auto',
					options: {
						icon: 'refresh',
						onClick() {
							$("#node_chart_" + node.id).dxChart('instance').refresh();
							$("#node_chart_polar_" + node.id).dxPolarChart('instance').refresh();
							DevExpress.ui.notify('Refresh button has been clicked!');
						},
					},
				}, {
					location: 'center',
					widget: 'dxDateBox',
					locateInMenu: 'auto',
					options: {
						applyValueMode: 'useButtons',
						width: 100,
						value: new Date(),
						max: new Date(),
						min: new Date(2000, 0, 1),
						onValueChanged(data) {
							change_chart_data(node.id, new Date(data.value));
						},
					},
				}, {
					location: 'center',
					widget: 'dxDropDownButton',
					locateInMenu: 'auto',
					options: {
						icon: 'chart',
						dropDownOptions: {
							width: 100,
						},
						onItemClick(e) {
							//console.log(e.itemData);
							change_chart_type(node.id, e.itemData);
						},
						items: [
							{id: 1, name: 'Bar', icon: 'chart' },
							{id: 4, name: 'Line', icon: 'email'},
							{id: 2, name: 'Polar', icon: 'group' },
						],
						displayExpr: 'name',
						keyExpr: 'id',
					},
				}, {
					location: 'after',
					widget: 'dxButton',
					locateInMenu: 'auto',
					options: {
						text: 'Find',
						onClick() {
							DevExpress.ui.notify('Find button has been clicked!');
						},
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Print',
						onClick() {
							DevExpress.ui.notify('Print option has been clicked!');
						},
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Settings',
						onClick() {
							DevExpress.ui.notify('Settings option has been clicked!');
						},
					},
				},
			],
		});
	}

	// CHANGE CHART TYPE
	function change_chart_type(id, chart_type) {
		//console.log(chart_type);
		if (chart_type.name === 'Bar') {
			$("#node_chart_" + id).show();
			$("#node_chart_polar_" + id).hide();
		} else if (chart_type.name === 'Polar') {
			$("#node_chart_" + id).hide();
			$("#node_chart_polar_" + id).show();
		} else if (chart_type.name === 'Line') {
			$("#node_chart_" + id).show();
			$("#node_chart_polar_" + id).hide();
		}		
	}

	// CHANGE CHART DATA
	function change_chart_data(id, date) {		

		var history = [];
		var pulse_volume_factor = 1;

		console.log(date);

		$.each(node_list_data, function(i, node) {
			if (node.id == id) {
				// GENERATE DATA
				$.each(node.history, function(i, reading) {
					if (reading.Data_DateTime.toDateString() === date.toDateString()) {
						// GENERATE DATA
						$.each(node.baseline, function(i, baseline) {
							if (reading.Data_DateTime.getHours() == baseline.Hour) {
								reading['Baseline'] = (baseline.RealPower_L1 + baseline.RealPower_L2 + baseline.RealPower_L3) / 3;
							}
						});
						// PUSH
						history.push(reading)
					}
				});

				// SET BAR CHART DATA
				$("#node_chart_" + node.id).dxChart("option", "dataSource", history.map(function(element) {return {'Data_DateTime': element.Data_DateTime, 'L1': Math.abs(element.RealPower_L1), 'L2': Math.abs(element.RealPower_L2), 'L3': Math.abs(element.RealPower_L3)};}));
				$("#node_chart_" + node.id).dxChart('instance').refresh();
							
				// SET POLAR CHART DATA
				$("#node_chart_polar_" + node.id).dxPolarChart("option", "dataSource", history.map(function(element) {return {'Data_DateTime': element.Data_DateTime, 'L1': Math.abs(element.RealPower_L1), 'L2': Math.abs(element.RealPower_L2), 'L3': Math.abs(element.RealPower_L3)};}));
				$("#node_chart_polar_" + node.id).dxPolarChart('instance').refresh();

				// SET VALUES
				set_text(node.id, node);
			}			
		});		
	}

	

	// SET MAP MARKERS
	function set_map_markers(node) {
		if (node.Node_Status == 1) {icon = '/static/assets/img/map/error_marker.png'} else {icon = '/static/assets/img/map/ok_marker.png'}					
		newMarker = {
			location: {
				lat: node.Lat, 
				lng: node.Lng
			},
			tooltip: {
				text: node.Name,
			},
			iconSrc: icon,
		}
		markersData.push(newMarker)			
	}

	// SET STATUS MARKERS
	function set_status_markers(node) {
		//console.log(node.Name + ': ' + parseInt(Math.abs(new Date()-new Date(node.Last_Updated)) / (1000 * 60)))
		if (parseInt(Math.abs(new Date()-new Date(node.Last_Updated)) / (1000 * 60)) > 2) {
			$('#Node_Status_' + node.id).addClass('bg-danger');
			$('#Node_Status_' + node.id).attr('title', 'Last time data updated was too long.');
			$("#hidden_Node_Status_" + node.id).val('1');
		} else {
			$('#Node_Status_' + node.id).removeClass('bg-danger');
			$("#hidden_Node_Status_" + node.id).val('0');
		}
	}

	// CREATE FAKE DATA
	function fake_data(id) {
		var start = new Date("06/05/2022");
		var end = new Date("07/05/2022");
		var loop = new Date(start);

		while (loop <= end) {
			data = {
				"Node": id,
				"Data_DateTime": loop,
				"Pulses": Math.floor((Math.random() * 10) + 1),
				"Battery_Level": 100,
				"Battery_Voltage": 3.2
            }

			$.ajax({
				type: 'POST',
				url: '../dalys/readings/data/',
				headers: {
					"Authorization": "Basic " + btoa("admin" + ":" + "will1977"),
					"X-CSRFTOKEN": "{{ csrf_token }}",
				},
				dataType: 'json',
				contentType: "application/json",
				data: JSON.stringify(data),
				success: function (data) {
					//console.log(data);
				},
				async: false
			});

			var newDate = loop.setTime(loop.getTime() + 1*60*60*1000);
			loop = new Date(newDate);

			break
		}
	}


	//////////////////////////////////////////////////////////////////////////
	// DATA ANALYSIS
	//////////////////////////////////////////////////////////////////////////

	// SET CHART DATA
	//$("#data_analysis_chart").dxChart("option", "dataSource", history.map(function(element) {return {'Data_DateTime': element.Data_DateTime, 'Power': element.Pulses*node.Pulse_Unit_Value*pulse_volume_factor, 'Baseline': element.Baseline*node.Pulse_Unit_Value*pulse_volume_factor};}));
	//$("#data_analysis_chart").dxChart('instance').refresh();

	
	$(".nav-link").click(function (event) {
		$("#data_analysis_chart").dxChart('instance').refresh();
	});

	var renderDataAnalysis = function () {
		// RANGE
		var range = $('#data_analysis_range').dxRangeSelector({			
			scale: {
				startValue: new Date(2022, 1, 1),
				endValue: new Date(),
				minorTickInterval: 'day',
				tickInterval: 'week',
				minRange: 'week',
				maxRange: 'month',
				minorTick: {
					visible: false,
				},
			},
			sliderMarker: {
				format: 'monthAndDay',
			},
			value: [new Date(2022, 5, 1), new Date()],
		});
		// CREATE SERIES
		var series = [
			{
				type: 'spline',
				name: 'L1',
				valueField: 'L1',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			},{
				type: 'spline',
				name: 'L2',
				valueField: 'L2',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			},{
				type: 'spline',
				name: 'L3',
				valueField: 'L3',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			},//{
			//	type: 'spline',
			//	name: 'Baseline',
			//	valueField: 'Baseline',
			//	argumentField: "Data_DateTime",
			//	argumentType: "datetime",
			//}
		];
		// CHART
		var chart = $('#data_analysis_chart').dxChart({
			palette: 'red',
			commonSeriesSettings: {
				point: {
					visible: false,
				},
			},
			size: {
				height: 360,
			},
			loadingIndicator: {
				enabled: true
			},
			argumentAxis: {
				argumentType: "datetime",
				label: {
					format: "shortDateShortTime"
				},
				valueMarginsEnabled: false,
				discreteAxisDivisionMode: 'crossLabels',
				grid: {
					visible: true,
				},
			},
			series: series,
			tooltip: {
				enabled: true,
			},
			legend: {
				verticalAlignment: 'top',
				horizontalAlignment: 'center',
				hoverMode: 'excludePoints',
			},
			crosshair: {
				enabled: true,
				color: '#949494',
				width: 1,
				dashStyle: 'dot',
				label: {
					visible: true,
					backgroundColor: '#949494',
					font: {
					color: '#fff',
					size: 12,
					},
				},
			},
			export: {
				enabled: false,
			},
			onPointClick: function (e) {
				var point = e.target;
				if (point.isSelected()) {
					point.clearSelection();
				} else {
					point.select();					
				}
			}
		});
		// TOOL BAR
		var toolbar = $('#data_analysis_toolbar').dxToolbar({
			items: [
			{
					location: 'before',
					widget: 'dxButton',
					locateInMenu: 'auto',
					options: {
						icon: 'refresh',
						onClick() {
							DevExpress.ui.notify('Refresh button has been clicked!');
						},
					},
				}, {
					location: 'center',
					widget: 'dxSelectBox',
					locateInMenu: 'auto',
					options: {
						items: [
							{
								id: 1,
								text: 'Main Power Supply',
							}, {
								id: 2,
								text: 'Blast Freezer',
							}, {
								id: 3,
								text: 'Main Ward Block',
							}, {
								id: 4,
								text: 'Maternity Basement Node',
							}, {
								id: 5,
								text: 'Wastewater Flume',
							}
						],
						valueExpr: 'id',
						displayExpr: 'text',
						value: 1,
						onValueChanged(args) {
							
						},
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Print',
						onClick() {
							DevExpress.ui.notify('Print option has been clicked!');
						},
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Settings',
						onClick() {
							DevExpress.ui.notify('Settings option has been clicked!');
						},
					},
				},
			],
		});
	};


	//////////////////////////////////////////////////////////////////////////
	// REPORTS
	//////////////////////////////////////////////////////////////////////////

	// GET REPORT DATA BY DATE RANGE
	function reportData(from, to) {
		//console.log(node_list_data);
		var data = [];		
		$.each(node_list_data, function(i, node) {
			
			var power = 0
			$.each(node.report, function(i, report) {
				if (dateCheck(from,to,report.Data_DateTime)) {
					power += Math.abs(report.RealPower_L1) + Math.abs(report.RealPower_L2) + Math.abs(report.RealPower_L3);
				}				
			});

			if (node.Category == 'Supply') {
				var supply = power.toFixed(3);
			} else if (node.Category == 'Waste') {
				var waste = power.toFixed(3);
			} else if (node.Category == 'Consumer') {
				var consumer = power.toFixed(3);
			}
			// PUSH
			data.push({
				ID: node.id, 
				Node: node.Name, 
				Power: power.toFixed(3),
				Supply: supply,
				Waste: waste,
				Consumer: consumer, 
				Type: node.Category,
			})
		});
		return data;
	}

	function dateCheck(from, to, check) {
		if((check <= to && check >= from)) {
			return true;
		}
		return false;
	}

	function change_reporting_data(date, type) {

		var from = $("#reporting_toolbar").dxToolbar('instance').option('items')[2].options.value;
		var to = $("#reporting_toolbar").dxToolbar('instance').option('items')[4].options.value;

		if (type == 'from') {
			from = date;
		} else {
			to = date;
		}

		var data = reportData(new Date(from), new Date(to));

		var new_data = [];
		var supply = 0;
		var consumer = 0;
		var waste = 0;
		$.each(data, function(i, node) {
			if (node.Type == 'Supply') {
				supply += parseFloat(node.Power);
			} else if (node.Type == 'Consumer') {
				new_data.push(node);
				consumer += parseFloat(node.Power);
			} else if (node.Type == 'Waste') {
				waste += parseFloat(node.Power);
			}
		});
		var not_nodeed = supply-consumer;
		new_data.push({
			ID: 0, 
			Node: 'Not Nodeed', 
			Power: not_nodeed.toFixed(3),
			Supply: null,
			Waste: null,
			Consumer: null, 
			Type: 'Not Nodeed',
		})
		var Difference_In_Days = (new Date(to).getTime() - new Date(from).getTime()) / (1000 * 3600 * 24);

		// PIE CHART DATA
		$("#reporting_pie").dxPieChart("option", "dataSource", new_data);
		$("#reporting_pie").dxPieChart('instance').refresh();

		// BAR CHART DATA
		$("#reporting_bar").dxChart("option", "dataSource", data);
		$("#reporting_bar").dxChart('instance').refresh();

		// LEDGER DATA
		$("#reporting_ledger").dxDataGrid("option", "dataSource", data);
		$("#reporting_ledger").dxDataGrid('instance').refresh();

		// TEXT
		$("#report_period").text(Difference_In_Days.toFixed(0));
		$("#report_from").text(new Date(from).toDateString());
		$("#report_to").text(new Date(to).toDateString());
		$("#report_not_nodeed").text(not_nodeed.toFixed(3));
		$("#report_waste").text(waste.toFixed(3));
	}

	var renderReport = function () {

		// PIE CHART
		var piechart = $('#reporting_pie').dxPieChart({
			palette: 'red',
			//dataSource: data,
			legend: {
				horizontalAlignment: 'center',
				verticalAlignment: 'bottom',
			},
			series: [{
				argumentField: 'Node',
				valueField: 'Power',
				label: {
					visible: true,
					connector: {
						visible: true,
						width: 0.5,
					},
					format: 'fixedPoint',
					customizeText(point) {
						return `${point.value} m3`;
					},
				},
			}],
		});

		// BAR CHART
		var barChart = $('#reporting_bar').dxChart({
			//dataSource: data,
			palette: 'red',
			commonSeriesSettings: {
				type: 'bar',
				valueField: 'Power',
				argumentField: 'Node',
				ignoreEmptyPoints: true,
			},
			rotated: true,
			seriesTemplate: {
				nameField: 'Node',
			},
		});

		// LEDGER		
		var dataGrid = $('#reporting_ledger').dxDataGrid({
			//dataSource: data,
			keyExpr: 'ID',
			showColumnLines: false,
			showRowLines: true,
			rowAlternationEnabled: false,
			showBorders: true,
			columns: [
				{
					dataField: 'Node',
				}, {
					dataField: 'Supply',
					width: 100,
				}, {
					dataField: 'Consumer',
					width: 100,
				}, {
					dataField: 'Waste',
					width: 100,
				},
			],
			summary: {
				totalItems: [
					{
						summaryType: 'sum',
						displayFormat: '{0}',
						column: 'Supply',
					}, {
						summaryType: 'sum',
						displayFormat: '{0}',
						column: 'Consumer',
					}, {
						summaryType: 'sum',
						displayFormat: '{0}',
						column: 'Waste',
					}
				],
			},
		});
									
		// TOOL BAR
		var toolbar = $('#reporting_toolbar').dxToolbar({
			items: [
			{
					location: 'before',
					widget: 'dxButton',
					locateInMenu: 'auto',
					options: {
						icon: 'refresh',
						onClick() {
							DevExpress.ui.notify('Refresh button has been clicked!');
						},
					},
				}, {
					location: 'center',
					locateInMenu: 'never',
					template() {
						return $("<div class='toolbar-label'><b>Start Date: </b></div>");
					},
				}, {
					id: 'from',
					location: 'center',
					widget: 'dxDateBox',
					locateInMenu: 'auto',
					options: {
						applyValueMode: 'useButtons',
						width: 100,
						value: new Date(),
						max: new Date(),
						min: new Date(2000, 0, 1),
						onValueChanged(data) {
							change_reporting_data(data.value, 'from');
						},
					},
				}, {
					location: 'center',
					locateInMenu: 'never',
					template() {
						return $("<div class='toolbar-label'><b>End Date: </b></div>");
					},
				}, {
					id: 'to',
					location: 'center',
					widget: 'dxDateBox',
					locateInMenu: 'auto',
					options: {
						applyValueMode: 'useButtons',
						width: 100,
						value: new Date(),
						max: new Date(),
						min: new Date(2000, 0, 1),
						onValueChanged(data) {
							change_reporting_data(data.value, 'to');
						},
					},
				}, {
					location: 'center',
					widget: 'dxDropDownButton',
					locateInMenu: 'auto',
					options: {
						icon: 'chart',
						dropDownOptions: {
							width: 100,
						},
						onItemClick(e) {
							change_reporting_chart_type(e.itemData);
						},
						items: [
							{id: 1, name: 'Bar', icon: 'chart' },
							{id: 2, name: 'Pie', icon: 'pie-chart'},
						],
						displayExpr: 'name',
						keyExpr: 'id',
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Save',
						onClick() {
							DevExpress.ui.notify('Save option has been clicked!');
						},
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Print',
						onClick() {
							DevExpress.ui.notify('Print option has been clicked!');
						},
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Settings',
						onClick() {
							DevExpress.ui.notify('Settings option has been clicked!');
						},
					},
				},
			],
		});

		function change_reporting_chart_type(item) {
			if (item.name == 'Bar') {
				$("#reporting_pie").hide();
				$("#reporting_bar").show();
			} else if (item.name == 'Pie') {
				$("#reporting_pie").show();
				$("#reporting_bar").hide();
			}
		};

		$("#reporting_pie").show();
		$("#reporting_bar").hide();

		var date = new Date();
		const data = change_reporting_data(date.setDate(date.getDate() - 1), 'from');

	};
	//////////////////////////////////////////////////////////////////////////














	// process nodes
	function process_nodes() {
		// CREATE
		$.each(node_list_data, function(i, node) {
			// process node data
			if (node.history.length !== 0){
				process_node(node.id, node)				
			}
		});
		// PUSH MAP MARKERS
		$("#siteMap").dxMap({
			//zoom: 5,
			markers: markersData
		});
	}
	// process individual nodes
	function process_node(node_id, node) {

		// READINGS
		var readings = [];

		// GENERATE DATA
		$.each(node.history, function(i, reading) {
			// LAST 24 HOURS
			var hoursBetweenDates = (reading.Data_DateTime.getTime() - new Date().getTime()) / (60 * 60 * 1000);
			if (reading.Data_DateTime.toDateString() === new Date().toDateString()) {
				// GENERATE DATA
				$.each(node.baseline, function(i, baseline) {
					if (reading.Data_DateTime.getHours() == baseline.Hour) {
						//reading['Baseline'] = baseline.Pulses;
					}
				});
				// PUSH
				readings.push(reading)
			}
		});

		// SET CHART DATA
		$("#node_chart_" + node_id).dxChart("option", "dataSource", readings.map(function(element) {return {'Data_DateTime': element.Data_DateTime, 'L1': Math.abs(element.RealPower_L1), 'L2': Math.abs(element.RealPower_L2), 'L3': Math.abs(element.RealPower_L3)};}));
		$("#node_chart_" + node_id).dxChart('instance').refresh();
		// SET POLAR CHART DATA
		$("#node_chart_polar_" + node_id).dxPolarChart("option", "dataSource", readings.map(function(element) {return {'Data_DateTime': element.Data_DateTime, 'L1': Math.abs(element.RealPower_L1), 'L2': Math.abs(element.RealPower_L2), 'L3': Math.abs(element.RealPower_L3)};}));
		$("#node_chart_polar_" + node_id).dxPolarChart('instance').refresh();
		// SET LOG VALUES
		$("#log2_" + node_id).dxDataGrid("option", "dataSource", readings.map(function(element) {return {'ID': element.id, 'Data_DateTime': element.Data_DateTime, 'L1': Math.abs(element.RealPower_L1), 'L2': Math.abs(element.RealPower_L2), 'L3': Math.abs(element.RealPower_L3)};}));
		$("#log2_" + node_id).dxDataGrid('instance').refresh();
		// SET CHART DATA
		$("#data_analysis_chart").dxChart("option", "dataSource", readings.map(function(element) {return {'Data_DateTime': element.Data_DateTime, 'L1': Math.abs(element.RealPower_L1), 'L2': Math.abs(element.RealPower_L2), 'L3': Math.abs(element.RealPower_L3)};}));
		$("#data_analysis_chart").dxChart('instance').refresh();
		// SET VALUES
		set_text(node_id, node)
		// SET MAP MARKERS
		set_map_markers(node);
		// SET STATUS MARKERS
		set_status_markers(node);			
		// CREATE FAKE DATA
		//fake_data(node_id);
	}
	// percentage function
	function getPercentage(act, max) {
		return (act / max) * 100;
	}
	// set page text
	function set_text(id, json_data) {
		// total
		var ap_total = (Math.abs(json_data.AppaPower_L1) + Math.abs(json_data.AppaPower_L2) + Math.abs(json_data.AppaPower_L3)) / 1000		
		// apparent power
		$("#apparent_power_value_" + id).text(ap_total.toFixed(3));
		$("#apparent_power_bar_" + id).attr('style', 'width: ' + getPercentage(ap_total, 600).toFixed(0) + '%');
		$("#apparent_power_info_" + id).text('@ ' + getPercentage(ap_total, 600).toFixed(0) + '% of 600 kW.');
		// real power
		var rp_total = (Math.abs(json_data.RealPower_L1) + Math.abs(json_data.RealPower_L2) + Math.abs(json_data.RealPower_L3)) / 1000
		$("#value_main_" + id).text(rp_total.toFixed(3));
		$("#real_power_value_" + id).text(rp_total.toFixed(3));
		$("#real_power_bar_" + id).attr('style', 'width: ' + getPercentage(rp_total, 600).toFixed(0) + '%');
		$("#real_power_info_" + id).text('@ ' + getPercentage(rp_total, 600).toFixed(0) + '% of 600 kW.');
		// irms
		var irms_total = (Math.abs(json_data.Irms_L1) + Math.abs(json_data.Irms_L2) + Math.abs(json_data.Irms_L3))
		$("#irms_value_" + id).text(irms_total.toFixed(3));
		$("#irms_bar_" + id).attr('style', 'width: ' + getPercentage(irms_total, 600).toFixed(0) + '%');
		$("#irms_info_" + id).text('@ ' + getPercentage(irms_total, 600).toFixed(0) + '% of 600 A.');
		// vrms
		var vrms_ave = (Math.abs(json_data.Vrms_L1) + Math.abs(json_data.Vrms_L2) + Math.abs(json_data.Vrms_L3)) / 3
		$("#vrms_value_" + id).text(vrms_ave.toFixed(3));
		$("#vrms_bar_" + id).attr('style', 'width: ' + getPercentage(vrms_ave, 250).toFixed(0) + '%');
		$("#vrms_info_" + id).text('@ ' + getPercentage(vrms_ave, 250).toFixed(0) + '% of 250 V.');
		// power factor
		var power_factor_ave = (Math.abs(json_data.PowerFact_L1) + Math.abs(json_data.PowerFact_L2) + Math.abs(json_data.PowerFact_L3)) / 3
		$("#power_factor_value_" + id).text(power_factor_ave.toFixed(3));
		$("#power_factor_bar_" + id).attr('style', 'width: ' + getPercentage(power_factor_ave, 1).toFixed(0) + '%');
		$("#power_factor_info_" + id).text('@ ' + getPercentage(power_factor_ave, 1).toFixed(0) + '%.');
	}
	// wesocket
	var startWebSocket = function () {
		var autosondeSocket;
		var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
		var ws_path = ws_scheme + '://' + window.location.host + ':8001/dalys/';
		var ws_path = 'wss://www.enviroscan.io:8001/dalys/';
		console.log(ws_path)
		autosondeSocket = new WebSocket(ws_path);    

		autosondeSocket.onmessage = function (e) {
			json_data = JSON.parse(e.data).message;
			console.log(json_data);
			// process node
			process_node(json_data.Node_ID, json_data)
			//set_text(json_data.Node_ID, json_data);
			
		};

		autosondeSocket.onclose = function (e) {
			console.log('Socket is closed. Reconnect will be attempted in 1 second.', e.reason);
		};

		autosondeSocket.onerror = function (err) {
			console.error(err);
		};
	};
	// get data
	var node_list_data = JSON.parse('{{node_list_data|escapejs}}', reviver_1).Data;
	console.log(node_list_data);
	/* Controller
	------------------------------------------------ */
	$(document).ready(function () {	
		
		page_setup();

		//ajax_call();
		renderReport();
		renderDataAnalysis();
		process_nodes();
		startWebSocket();		
		
		//var interval_status = 60000; // 60 secs
		//setInterval(ajax_call, interval_status);

		$(document).on('theme-reload', function () {
			//ajax_call();
		});

	});
</script>
{% endblock javascripts %}