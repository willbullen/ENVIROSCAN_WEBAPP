{% extends "app_dalys/layouts/base.html" %}


{% block content %}
<!-- BEGIN #content -->
<div id="content" class="app-content">
	<!-- BEGIN page-header -->
	<div class="d-flex fw-bold small">
		<span class="flex-grow-1">
			<h1 class="page-header">
				<i class="bi bi-power"></i> Dalys Power
			</h1>
			<div class="text-white small mb-2"><b></b></div>
		</span>
	</div>
	<!-- END page-header -->

	<!-- BEGIN -->
	<!-- BEGIN #listWidget -->
	<div id="listWidget" class="mb-5">
		<div class="card">
			<div class="card-body">
				<div class="row">
					<div class="col-xl-6">

						<!-- BEGIN SUPPLY -->
						<div class="text-white small mb-2"><b>SUPPLY</b></div>
						<div class="list-group mb-3">							
						{% for node in node_list_supply %}
							<!-- BEGIN NODE -->
							<input type="hidden" id="hidden_Node_Status_{{ node.id }}" value="0">
							<input type="hidden" id="hidden_Node_Status_{{ node.id }}" value="0">
							<div class="list-group-item d-flex align-items-center">
								<a href="#" class="text-white text-opacity-50" data-bs-toggle="collapse" data-bs-target="#collapse_{{ node.id }}" id="#go_map_{{ node.id }}">
									<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
										{{ node.Name|make_list|first }}
									</div>
								</a>
								<div class="flex-fill px-3">									
									<a href="#" class="text-white" data-bs-toggle="collapse" data-bs-target="#collapse_{{ node.id }}" id="slider_{{ node.id }}">							
										<div class="fw-bold">{{ node.Name }}</div>
									</a>
								</div>								

								<!-- <div class="flex-fill px-3">
									<div class="small text-white text-opacity-50">Last Updated: {{ node.Last_Updated|timesince }}</div>
								</div> -->

								<div class="opacity-10 px-3">
									<div class="fw-bold"><span id="value_main_{{ node.id }}">0</span> kW</div>
								</div>

								<div class="opacity-10 px-3">
									<span id="Node_Status_{{ node.id }}" class="badge bg-theme" data-bs-toggle="tooltip">M</span>
									<span id="Node_Status_{{ node.id }}" class="badge bg-theme" data-bs-toggle="tooltip">N</span>
								</div>
							</div>
							<!-- END NODE -->

							<!-- BEGIN NODE DETAILS -->
							<div class="collapse list-group-item" id="collapse_{{ node.id }}">

								<!-- BEGIN nav-tabs -->
								<ul class="nav nav-tabs nav-tabs">
									<li class="nav-item me-3"><a href="#home_{{ node.id }}" class="nav-link active" data-bs-toggle="tab">Data</a></li>
									<li class="nav-item me-3"><a href="#details_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Details</a></li>
									<li class="nav-item me-3"><a href="#logs_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Logs</a></li>
									<li class="nav-item me-3"><a href="#settings_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Settings</a></li>
								</ul>
								<!-- END nav-tabs -->

								<!-- BEGIN tab-content -->
								<div class="tab-content pt-1">
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade show active" id="home_{{ node.id }}">
										<!-- BEGIN TOOLBAR -->
										<nav class="navbar navbar-expand-lg navbar-dark bg-opacity-25 rounded">
											<div class="container-fluid">
												<!-- BEGIN REFRESH BUTTON -->
												<div class="opacity-10 px-1">
													<button id="refresh_{{ node.id }}" type="button" class="btn btn-outline-theme btn-sm"><i class="fa fa-redo"></i></button>
												</div>
												<!-- END REFRESH BUTTON -->
												<!-- BEGIN DATE PICKER -->
												<div class="flex-fill px-1">
													<div id="daterange_{{ node.id }}" class="btn btn-outline-theme d-flex align-items-center text-start btn-sm">
														<span class="text-truncate">&nbsp;</span>
														<i class="fa fa-caret-down ms-auto"></i>
													</div>
												</div>
												<!-- END DATE PICKER -->
												<!-- BEGIN SELECT CHART TYPE -->
												<select id="select_chart_type_{{ node.id }}" class="form-select btn-outline-theme form-select-sm" style="width: 100px;">
													<option value="Bar"><i class="fa fa-bar-chart"></i>Bar</option>
													<option value="Line"><i class="fa fa-line-chart"></i>Line</option>
													<option value="Polar"><i class="fa fa-pie-chart"></i>Polar</option>
												</select>
												<!-- END SELECT CHART TYPE -->
												<!-- BEGIN FIND BUTTON -->
												<div class="opacity-10 px-1">
													<button id="find_{{ node.id }}" type="button" class="btn btn-outline-theme btn-sm"><i class="fa fa-search"></i></button>
												</div>
												<!-- END FIND BUTTON -->
											</div>
										</nav>
										<!-- END TOOLBAR -->
										<!-- BEGIN row -->
										<div class="row">
											<div class="col-9">												
												<!-- BEGIN CHART -->
												<div class="pt-1 flex-1">
													<div id="node_chart_{{ node.id }}" class="pt-1 flex-1"></div>
													<div id="node_chart_polar_{{ node.id }}" class="pt-1 flex-1"></div>												
												</div>
												<!-- END CHART -->
											</div>
											<div class="col-3">
												<!-- BEGIN REAL POWER -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														REAL POWER (kW)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="real_power_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="real_power_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="real_power_info_{{ node.id }}">@ 0% of 600 kW.</span>
													</div>
												</div>
												<!-- END REAL POWER -->
												<!-- BEGIN APPAR POWER -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														CONSUMED (kW/h)
													</div>													
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="total_kwh_value_{{ node.id }}">0</span></h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="total_kwh_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-0 text-truncate">
														<span id="total_kwh_day_{{ node.id }}"></span>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="total_kwh_night_{{ node.id }}"></span>
													</div>
												</div>
												<!-- END APPAR POWER -->
												<!-- BEGIN IRMS -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														CURRENT (A)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="irms_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-2">
														<div class="progress-bar bg-theme" id="irms_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="irms_info_{{ node.id }}">@ 0% of 200 A.</span>
													</div>
												</div>
												<!-- END IRMS -->
												<!-- BEGIN VRMS -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														COST (â‚¬)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="cost_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-2">
														<div class="progress-bar bg-theme" id="cost_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-0 text-truncate">
														<span id="cost_day_{{ node.id }}"></span>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="cost_night_{{ node.id }}"></span>
													</div>
												</div>
												<!-- END VRMS -->
												<!-- BEGIN POWER FACTOR
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														POWER FACTOR
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="power_factor_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="power_factor_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="power_factor_info_{{ node.id }}">@ 0%.</span>
													</div>
												</div>
												END POWER FACTOR -->
											</div>
										</div>
										<!-- END row -->
									</div>
									<!-- END tab-pane -->
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade" id="details_{{ node.id }}">

										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												START OF LOGGING
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Date }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												START INDEX
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Index }} kW
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												TOTAL CONSUMPTION
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Index }} kW
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												PULSE UNIT MEASUREMENT
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Pulse_Unit_Measurement }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												PULSE UNIT VALUE
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Pulse_Unit_Value }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												LOCATION LAT
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Lat }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												LOCATION LNG
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Lng }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												NODE TYPE
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Type }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												REGION
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Region }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												CATEGORY
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Category }}
											</div>
										</div>
										<!-- END DETAILS ROW -->

									</div>
									<!-- END tab-pane -->
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade" id="logs_{{ node.id }}">
										<!-- BEGIN DATATABLE -->
										<div class="pt-2 align-items-center">
											<table id="log2_{{ node.id }}"></table>
										</div>
										<!-- END DATATABLE -->
									</div>
									<!-- END tab-pane -->

									<!-- BEGIN SETTINGS -->
									<div class="tab-pane fade" id="settings_{{ node.id }}">
										<!-- BEGIN DATATABLE -->
										<div class="pt-2 align-items-center">
											<!-- BEGIN #notifications -->
											<div id="notifications" class="mb-5">
												<h6><i class="far fa-bell fa-fw text-theme"></i> Notifications</h6>
												<p>Enable or disable what notifications you want to receive.</p>
												<div class="card">
													<div class="list-group list-group-flush">
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Comments</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Tags</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw me-1"></i> Disabled
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Reminders</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, Email, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>New orders</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, Email, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
													</div>
													<div class="card-arrow">
														<div class="card-arrow-top-left"></div>
														<div class="card-arrow-top-right"></div>
														<div class="card-arrow-bottom-left"></div>
														<div class="card-arrow-bottom-right"></div>
													</div>
												</div>
											</div>
											<!-- END #notifications -->
										</div>
										<!-- END DATATABLE -->
									</div>
									<!-- END SETTINGS -->

								</div>
								<!-- END tab-content -->
								
							</div>
							<!-- END NODE DETAILS -->
						{% endfor %}
						</div>
						<!-- END SUPPLY -->



						<!-- BEGIN consumer -->
						<div class="text-white small mb-2"><b>CONSUMERS</b></div>
						<div class="list-group mb-3">							
						{% for node in node_list_consumer %}
							<!-- BEGIN NODE -->
							<input type="hidden" id="hidden_Node_Status_{{ node.id }}" value="0">
							<input type="hidden" id="hidden_Node_Status_{{ node.id }}" value="0">
							<div class="list-group-item d-flex align-items-center">
								<a href="#" class="text-white text-opacity-50" data-bs-toggle="collapse" data-bs-target="#collapse_{{ node.id }}" id="#go_map_{{ node.id }}">
									<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
										{{ node.Name|make_list|first }}
									</div>
								</a>
								<div class="flex-fill px-3">									
									<a href="#" class="text-white" data-bs-toggle="collapse" data-bs-target="#collapse_{{ node.id }}" id="slider_{{ node.id }}">							
										<div class="fw-bold">{{ node.Name }}</div>
									</a>
								</div>								

								<!-- <div class="flex-fill px-3">
									<div class="small text-white text-opacity-50">Last Updated: {{ node.Last_Updated|timesince }}</div>
								</div> -->

								<div class="opacity-10 px-3">
									<div class="fw-bold"><span id="value_main_{{ node.id }}">0</span> kW</div>
								</div>

								<div class="opacity-10 px-3">
									<span id="Node_Status_{{ node.id }}" class="badge bg-theme" data-bs-toggle="tooltip">M</span>
									<span id="Node_Status_{{ node.id }}" class="badge bg-theme" data-bs-toggle="tooltip">N</span>
								</div>
							</div>
							<!-- END NODE -->

							<!-- BEGIN NODE DETAILS -->
							<div class="collapse list-group-item" id="collapse_{{ node.id }}">

								<!-- BEGIN nav-tabs -->
								<ul class="nav nav-tabs nav-tabs">
									<li class="nav-item me-3"><a href="#home_{{ node.id }}" class="nav-link active" data-bs-toggle="tab">Data</a></li>
									<li class="nav-item me-3"><a href="#details_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Details</a></li>
									<li class="nav-item me-3"><a href="#logs_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Logs</a></li>
									<li class="nav-item me-3"><a href="#settings_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Settings</a></li>
								</ul>
								<!-- END nav-tabs -->

								<!-- BEGIN tab-content -->
								<div class="tab-content pt-1">
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade show active" id="home_{{ node.id }}">
										<!-- BEGIN TOOLBAR -->
										<nav class="navbar navbar-expand-lg navbar-dark bg-opacity-25 rounded">
											<div class="container-fluid">
												<!-- BEGIN REFRESH BUTTON -->
												<div class="opacity-10 px-1">
													<button id="refresh_{{ node.id }}" type="button" class="btn btn-outline-theme btn-sm"><i class="fa fa-redo"></i></button>
												</div>
												<!-- END REFRESH BUTTON -->
												<!-- BEGIN DATE PICKER -->
												<div class="flex-fill px-1">
													<div id="daterange_{{ node.id }}" class="btn btn-outline-theme d-flex align-items-center text-start btn-sm">
														<span class="text-truncate">&nbsp;</span>
														<i class="fa fa-caret-down ms-auto"></i>
													</div>
												</div>
												<!-- END DATE PICKER -->
												<!-- BEGIN SELECT CHART TYPE -->
												<select id="select_chart_type_{{ node.id }}" class="form-select btn-outline-theme form-select-sm" style="width: 100px;">
													<option value="Bar"><i class="fa fa-bar-chart"></i>Bar</option>
													<option value="Line"><i class="fa fa-line-chart"></i>Line</option>
													<option value="Polar"><i class="fa fa-pie-chart"></i>Polar</option>
												</select>
												<!-- END SELECT CHART TYPE -->
												<!-- BEGIN FIND BUTTON -->
												<div class="opacity-10 px-1">
													<button id="find_{{ node.id }}" type="button" class="btn btn-outline-theme btn-sm"><i class="fa fa-search"></i></button>
												</div>
												<!-- END FIND BUTTON -->
											</div>
										</nav>
										<!-- END TOOLBAR -->
										<!-- BEGIN row -->
										<div class="row">
											<div class="col-9">												
												<!-- BEGIN CHART -->
												<div class="pt-1 flex-1">
													<div id="node_chart_{{ node.id }}" class="pt-1 flex-1"></div>
													<div id="node_chart_polar_{{ node.id }}" class="pt-1 flex-1"></div>												
												</div>
												<!-- END CHART -->
											</div>
											<div class="col-3">
												<!-- BEGIN REAL POWER -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														REAL POWER (kW)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="real_power_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="real_power_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="real_power_info_{{ node.id }}">@ 0% of 600 kW.</span>
													</div>
												</div>
												<!-- END REAL POWER -->
												<!-- BEGIN APPAR POWER -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														CONSUMED (kW/h)
													</div>													
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="total_kwh_value_{{ node.id }}">0</span></h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="total_kwh_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-0 text-truncate">
														<span id="total_kwh_day_{{ node.id }}"></span>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="total_kwh_night_{{ node.id }}"></span>
													</div>
												</div>
												<!-- END APPAR POWER -->
												<!-- BEGIN IRMS -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														CURRENT (A)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="irms_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-2">
														<div class="progress-bar bg-theme" id="irms_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="irms_info_{{ node.id }}">@ 0% of 200 A.</span>
													</div>
												</div>
												<!-- END IRMS -->
												<!-- BEGIN VRMS -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														COST (â‚¬)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="cost_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-2">
														<div class="progress-bar bg-theme" id="cost_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-0 text-truncate">
														<span id="cost_day_{{ node.id }}"></span>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="cost_night_{{ node.id }}"></span>
													</div>
												</div>
												<!-- END VRMS -->
												<!-- BEGIN POWER FACTOR
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														POWER FACTOR
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="power_factor_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="power_factor_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="power_factor_info_{{ node.id }}">@ 0%.</span>
													</div>
												</div>
												END POWER FACTOR -->
											</div>
										</div>
										<!-- END row -->
									</div>
									<!-- END tab-pane -->
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade" id="details_{{ node.id }}">

										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												START OF LOGGING
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Date }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												START INDEX
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Index }} kW
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												TOTAL CONSUMPTION
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Index }} kW
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												PULSE UNIT MEASUREMENT
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Pulse_Unit_Measurement }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												PULSE UNIT VALUE
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Pulse_Unit_Value }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												LOCATION LAT
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Lat }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												LOCATION LNG
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Lng }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												NODE TYPE
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Type }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												REGION
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Region }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												CATEGORY
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Category }}
											</div>
										</div>
										<!-- END DETAILS ROW -->

									</div>
									<!-- END tab-pane -->
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade" id="logs_{{ node.id }}">
										<!-- BEGIN DATATABLE -->
										<div class="pt-2 align-items-center">
											<table id="log2_{{ node.id }}"></table>
										</div>
										<!-- END DATATABLE -->
									</div>
									<!-- END tab-pane -->

									<!-- BEGIN SETTINGS -->
									<div class="tab-pane fade" id="settings_{{ node.id }}">
										<!-- BEGIN DATATABLE -->
										<div class="pt-2 align-items-center">
											<!-- BEGIN #notifications -->
											<div id="notifications" class="mb-5">
												<h6><i class="far fa-bell fa-fw text-theme"></i> Notifications</h6>
												<p>Enable or disable what notifications you want to receive.</p>
												<div class="card">
													<div class="list-group list-group-flush">
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Comments</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Tags</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw me-1"></i> Disabled
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Reminders</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, Email, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>New orders</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, Email, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
													</div>
													<div class="card-arrow">
														<div class="card-arrow-top-left"></div>
														<div class="card-arrow-top-right"></div>
														<div class="card-arrow-bottom-left"></div>
														<div class="card-arrow-bottom-right"></div>
													</div>
												</div>
											</div>
											<!-- END #notifications -->
										</div>
										<!-- END DATATABLE -->
									</div>
									<!-- END SETTINGS -->

								</div>
								<!-- END tab-content -->
								
							</div>
							<!-- END NODE DETAILS -->
						{% endfor %}
						</div>
						<!-- END consumer -->





						<!-- BEGIN waste -->
						<div class="text-white small mb-2"><b>DISTRIBUTION</b></div>
						<div class="list-group mb-3">							
						{% for node in node_list_distribution %}
							<!-- BEGIN NODE -->
							<input type="hidden" id="hidden_Node_Status_{{ node.id }}" value="0">
							<input type="hidden" id="hidden_Node_Status_{{ node.id }}" value="0">
							<div class="list-group-item d-flex align-items-center">
								<a href="#" class="text-white text-opacity-50" data-bs-toggle="collapse" data-bs-target="#collapse_{{ node.id }}" id="#go_map_{{ node.id }}">
									<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
										{{ node.Name|make_list|first }}
									</div>
								</a>
								<div class="flex-fill px-3">									
									<a href="#" class="text-white" data-bs-toggle="collapse" data-bs-target="#collapse_{{ node.id }}" id="slider_{{ node.id }}">							
										<div class="fw-bold">{{ node.Name }}</div>
									</a>
								</div>								

								<!-- <div class="flex-fill px-3">
									<div class="small text-white text-opacity-50">Last Updated: {{ node.Last_Updated|timesince }}</div>
								</div> -->

								<div class="opacity-10 px-3">
									<div class="fw-bold"><span id="value_main_{{ node.id }}">0</span> kW</div>
								</div>

								<div class="opacity-10 px-3">
									<span id="Node_Status_{{ node.id }}" class="badge bg-theme" data-bs-toggle="tooltip">M</span>
									<span id="Node_Status_{{ node.id }}" class="badge bg-theme" data-bs-toggle="tooltip">N</span>
								</div>
							</div>
							<!-- END NODE -->

							<!-- BEGIN NODE DETAILS -->
							<div class="collapse list-group-item" id="collapse_{{ node.id }}">

								<!-- BEGIN nav-tabs -->
								<ul class="nav nav-tabs nav-tabs">
									<li class="nav-item me-3"><a href="#home_{{ node.id }}" class="nav-link active" data-bs-toggle="tab">Data</a></li>
									<li class="nav-item me-3"><a href="#details_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Details</a></li>
									<li class="nav-item me-3"><a href="#logs_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Logs</a></li>
									<li class="nav-item me-3"><a href="#settings_{{ node.id }}" class="nav-link" data-bs-toggle="tab">Settings</a></li>
								</ul>
								<!-- END nav-tabs -->

								<!-- BEGIN tab-content -->
								<div class="tab-content pt-1">
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade show active" id="home_{{ node.id }}">
										<!-- BEGIN TOOLBAR -->
										<nav class="navbar navbar-expand-lg navbar-dark bg-opacity-25 rounded">
											<div class="container-fluid">
												<!-- BEGIN REFRESH BUTTON -->
												<div class="opacity-10 px-1">
													<button id="refresh_{{ node.id }}" type="button" class="btn btn-outline-theme btn-sm"><i class="fa fa-redo"></i></button>
												</div>
												<!-- END REFRESH BUTTON -->
												<!-- BEGIN DATE PICKER -->
												<div class="flex-fill px-1">
													<div id="daterange_{{ node.id }}" class="btn btn-outline-theme d-flex align-items-center text-start btn-sm">
														<span class="text-truncate">&nbsp;</span>
														<i class="fa fa-caret-down ms-auto"></i>
													</div>
												</div>
												<!-- END DATE PICKER -->
												<!-- BEGIN SELECT CHART TYPE -->
												<select id="select_chart_type_{{ node.id }}" class="form-select btn-outline-theme form-select-sm" style="width: 100px;">
													<option value="Bar"><i class="fa fa-bar-chart"></i>Bar</option>
													<option value="Line"><i class="fa fa-line-chart"></i>Line</option>
													<option value="Polar"><i class="fa fa-pie-chart"></i>Polar</option>
												</select>
												<!-- END SELECT CHART TYPE -->
												<!-- BEGIN FIND BUTTON -->
												<div class="opacity-10 px-1">
													<button id="find_{{ node.id }}" type="button" class="btn btn-outline-theme btn-sm"><i class="fa fa-search"></i></button>
												</div>
												<!-- END FIND BUTTON -->
											</div>
										</nav>
										<!-- END TOOLBAR -->
										<!-- BEGIN row -->
										<div class="row">
											<div class="col-9">												
												<!-- BEGIN CHART -->
												<div class="pt-1 flex-1">
													<div id="node_chart_{{ node.id }}" class="pt-1 flex-1"></div>
													<div id="node_chart_polar_{{ node.id }}" class="pt-1 flex-1"></div>												
												</div>
												<!-- END CHART -->
											</div>
											<div class="col-3">
												<!-- BEGIN REAL POWER -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														REAL POWER (kW)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="real_power_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="real_power_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="real_power_info_{{ node.id }}"></span>
													</div>
												</div>
												<!-- END REAL POWER -->
												<!-- BEGIN APPAR POWER -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														CONSUMED (kW/h)
													</div>													
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="total_kwh_value_{{ node.id }}">0</span></h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="total_kwh_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-0 text-truncate">
														<span id="total_kwh_day_{{ node.id }}"></span>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="total_kwh_night_{{ node.id }}"></span>
													</div>
												</div>
												<!-- END APPAR POWER -->
												<!-- BEGIN IRMS -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														CURRENT (A)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="irms_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-2">
														<div class="progress-bar bg-theme" id="irms_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="irms_info_{{ node.id }}">@ 0% of 200 A.</span>
													</div>
												</div>
												<!-- END IRMS -->
												<!-- BEGIN VRMS -->
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														COST (â‚¬)
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="cost_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-2">
														<div class="progress-bar bg-theme" id="cost_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-0 text-truncate">
														<span id="cost_day_{{ node.id }}"></span>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="cost_night_{{ node.id }}"></span>
													</div>
												</div>
												<!-- END VRMS -->
												<!-- BEGIN POWER FACTOR
												<div class="w-150px h-98px pt-1 ps-3">
													<div class="d-flex fw-bold small text-white text-opacity-50 mb-1">
														POWER FACTOR
													</div>
													<div class="mb-2 fs-5 text-truncate">
														<h4 class="mb-0"><span id="power_factor_value_{{ node.id }}">0</span> </h4>
													</div>
													<div class="progress h-3px bg-white-transparent-2 mb-1">
														<div class="progress-bar bg-theme" id="power_factor_bar_{{ node.id }}" style="width: 0%"></div>
													</div>
													<div class="fs-11px text-white text-opacity-50 mb-2 text-truncate">
														<span id="power_factor_info_{{ node.id }}">@ 0%.</span>
													</div>
												</div>
												END POWER FACTOR -->
											</div>
										</div>
										<!-- END row -->
									</div>
									<!-- END tab-pane -->
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade" id="details_{{ node.id }}">

										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												START OF LOGGING
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Date }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												START INDEX
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Index }} kW
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												TOTAL CONSUMPTION
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Start_Index }} kW
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												PULSE UNIT MEASUREMENT
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Pulse_Unit_Measurement }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												PULSE UNIT VALUE
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Pulse_Unit_Value }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												LOCATION LAT
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Lat }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												LOCATION LNG
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Lng }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												NODE TYPE
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Type }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												REGION
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Region }}
											</div>
										</div>
										<!-- END DETAILS ROW -->
										<!-- BEGIN DETAILS ROW -->
										<div class="d-flex pt-2 align-items-center">
											<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1"></div>
											<div class="flex-fill fs-12px px-3">
												CATEGORY
											</div>			
											<div class="fs-12px ms-auto">
												{{ node.Category }}
											</div>
										</div>
										<!-- END DETAILS ROW -->

									</div>
									<!-- END tab-pane -->
									<!-- BEGIN tab-pane -->
									<div class="tab-pane fade" id="logs_{{ node.id }}">
										<!-- BEGIN DATATABLE -->
										<div class="pt-2 align-items-center">
											<table id="log2_{{ node.id }}"></table>
										</div>
										<!-- END DATATABLE -->
									</div>
									<!-- END tab-pane -->

									<!-- BEGIN SETTINGS -->
									<div class="tab-pane fade" id="settings_{{ node.id }}">
										<!-- BEGIN DATATABLE -->
										<div class="pt-2 align-items-center">
											<!-- BEGIN #notifications -->
											<div id="notifications" class="mb-5">
												<h6><i class="far fa-bell fa-fw text-theme"></i> Notifications</h6>
												<p>Enable or disable what notifications you want to receive.</p>
												<div class="card">
													<div class="list-group list-group-flush">
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Comments</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Tags</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw me-1"></i> Disabled
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>Reminders</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, Email, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
														<div class="list-group-item d-flex align-items-center">
															<div class="flex-1 text-break">
																<div>New orders</div>
																<div class="text-white text-opacity-50 d-flex align-items-center">
																	<i class="fa fa-circle fs-8px fa-fw text-success me-1"></i> Enabled (Push, Email, SMS)
																</div>
															</div>
															<div>
																<a href="#modalEdit" data-bs-toggle="modal" class="btn btn-outline-default w-100px">Edit</a>
															</div>
														</div>
													</div>
													<div class="card-arrow">
														<div class="card-arrow-top-left"></div>
														<div class="card-arrow-top-right"></div>
														<div class="card-arrow-bottom-left"></div>
														<div class="card-arrow-bottom-right"></div>
													</div>
												</div>
											</div>
											<!-- END #notifications -->
										</div>
										<!-- END DATATABLE -->
									</div>
									<!-- END SETTINGS -->

								</div>
								<!-- END tab-content -->
								
							</div>
							<!-- END NODE DETAILS -->
						{% endfor %}
						</div>
						<!-- END waste -->








					</div>
					<div class="col-xl-6">

						<!-- BEGIN NAV-TABS -->
						<ul id="tabs" class="nav nav-tabs nav-tabs">
							<li class="nav-item me-3"><a href="#reporting" class="nav-link active" data-bs-toggle="tab">Reporting</a></li>
							<li class="nav-item me-3"><a href="#data_analysis" class="nav-link" data-bs-toggle="tab">Data Analysis</a></li>
							<li class="nav-item me-3"><a href="#map" class="nav-link" data-bs-toggle="tab">Map</a></li>
							<!-- <li class="nav-item me-3"><a href="#schematics" class="nav-link" data-bs-toggle="tab">Schematics</a></li> -->							
						</ul>
						<!-- END NAV-TABS -->

						<!-- BEGIN tab-content -->
						<div class="tab-content">
							<!-- BEGIN TAB-PANE -->
							<div class="tab-pane fade" id="map">
								<!-- BEGIN TOOLBAR -->
								<div class="pt-1 mb-1" id="map_toolbar"></div>
								<!-- END TOOLBAR -->
								<!-- BEGIN MAP -->
								<div class="pt-1 mb-1" id="siteMap"></div>
								<!-- END MAP -->
							</div>
							<!-- END TAB-PANE -->

							<!-- BEGIN TAB-PANE
							<div class="tab-pane fade" id="schematics">
								<div id="schematics_toolbar"></div>
							</div>
							END TAB-PANE -->

							<!-- BEGIN TAB-PANE -->
							<div class="tab-pane fade show active" id="reporting">
								<!-- BEGIN TOOLBAR -->
								<nav class="navbar navbar-expand-lg navbar-dark bg-opacity-25 rounded">
									<div class="container-fluid">
										<!-- BEGIN REFRESH BUTTON -->
										<div class="opacity-10 px-1">
											<button id="refresh_reporting" type="button" class="btn btn-outline-theme btn-sm"><i class="fa fa-redo"></i></button>
										</div>
										<!-- END REFRESH BUTTON -->
										<!-- BEGIN DATE PICKER -->
										<div class="flex-fill px-1">
											<div id="daterange_reporting" class="btn btn-outline-theme d-flex align-items-center text-start btn-sm">
												<span class="text-truncate">&nbsp;</span>
												<i class="fa fa-caret-down ms-auto"></i>
											</div>
										</div>
										<!-- END DATE PICKER -->
										<!-- BEGIN SELECT CHART TYPE -->
										<select id="select_chart_type_reporting" class="form-select btn-outline-theme form-select-sm" style="width: 100px;">											
											<option value="Pie"><i class="fa fa-pie-chart"></i>Pie</option>
											<option value="Bar"><i class="fa fa-bar-chart"></i>Bar</option>
										</select>
										<!-- END SELECT CHART TYPE -->
									</div>
								</nav>
								<!-- END TOOLBAR -->
								<div class="pt-1 mb-1">
									<p>Totals for a <span id="report_period"></span> day period from <span id="report_from"></span> to the <span id="report_to"></span>, a total of <span id="report_not_nodeed"></span> of supply Value was not nodeed. The waste Value total for this period was <span id="report_waste"></span></p>
								</div>
								<!-- BEGIN PIE -->
								<div class="pt-1 mb-1" id="reporting_pie"></div>
								<!-- END PIE -->
								<!-- BEGIN PIE -->
								<div class="pt-1 mb-1" id="reporting_bar"></div>
								<!-- END PIE -->
								<!-- BEGIN GAUGE -->
								<div class="pt-1 mb-1" id="reporting_gauge"></div>
								<!-- END GAUGE -->

								<!-- BEGIN TABLE -->
								<div class="pt-1 mb-1">
									<table class="table">
										<thead class="table-dark">
											<tr>
												<th scope="col"></th>
												<th scope="col">Node</th>
												<th scope="col">Supply</th>
												<th scope="col">Consumers</th>
												<th scope="col">Cost</th>
												<th scope="col">
													<div class="form-check form-switch px-1">
														<input type="checkbox" class="form-check-input" id="toggle_money_kwh">
													</div>
												</th>
											</tr>
										</thead>
										<tbody>
											{% for node in node_list_supply %}
											<tr>
												<td>
													<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
														{{ node.Name|make_list|first }}
													</div>
												</td>
												<td>{{ node.Name }}</td>
												<td><span id="report_table_value_{{ node.id }}"></span></td>
												<td></td>
												<td></td>
												<td></td>
											</tr>
											{% endfor %}

											{% for node in node_list_consumer %}
											<tr>
												<td>
													<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
														{{ node.Name|make_list|first }}
													</div>
												</td>
												<td>{{ node.Name }}</td>
												<td></td>
												<td><span id="report_table_value_{{ node.id }}"></span></td>
												<td></td>
												<td></td>
											</tr>
											{% endfor %}
											
											{% for node in node_list_waste %}
											<tr>
												<td>
													<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-cyan-blue text-white rounded-2 ms-n1">
														{{ node.Name|make_list|first }}
													</div>
												</td>
												<td>{{ node.Name }}</td>
												<td></td>
												<td></td>
												<td><span id="report_table_value_{{ node.id }}"></span></td>
												<td></td>
											</tr>
											{% endfor %}
											<tr>
												<td></td>
												<td>TOTALS</td>
												<td><span id="report_supply_total_value"></span></td>
												<td><span id="report_consumer_total_value"></span></td>
												<td><span id="report_waste_total_value"></span></td>
												<td></td>
											</tr>
										</tbody>
									</table>
								</div>
								<!-- END TABLE -->
							</div>
							<!-- END TAB-PANE -->

							<!-- BEGIN TAB-PANE -->
							<div class="tab-pane fade" id="data_analysis">
								<!-- BEGIN TOOLBAR -->
								<nav class="navbar navbar-expand-lg navbar-dark bg-opacity-25 rounded">
									<div class="container-fluid">
										<!-- BEGIN REFRESH BUTTON -->
										<div class="opacity-10 px-1">
											<button id="refresh_da" type="button" class="btn btn-outline-theme btn-sm"><i class="fa fa-redo"></i></button>
										</div>
										<!-- END REFRESH BUTTON -->
										<!-- BEGIN DATE PICKER -->
										<div class="flex-fill px-1">
											<div id="daterange_da" class="btn btn-outline-theme d-flex align-items-center text-start btn-sm">
												<span class="text-truncate">&nbsp;</span>
												<i class="fa fa-caret-down ms-auto"></i>
											</div>
										</div>
										<!-- END DATE PICKER -->
										<!-- BEGIN SELECT CHART TYPE -->
										<select id="select_chart_type_da" class="form-select btn-outline-theme form-select-sm" style="width: 100px;">
											<option value="Bar"><i class="fa fa-bar-chart"></i>Bar</option>
											<option value="Line"><i class="fa fa-line-chart"></i>Line</option>
											<option value="Polar"><i class="fa fa-pie-chart"></i>Polar</option>
										</select>
										<!-- END SELECT CHART TYPE -->
										<!-- BEGIN FIND BUTTON -->
										<div class="opacity-10 px-1">
											<button id="find_da" type="button" class="btn btn-outline-theme btn-sm"><i class="fa fa-search"></i></button>
										</div>
										<!-- END FIND BUTTON -->
									</div>
								</nav>
								<!-- END TOOLBAR -->
								<!-- BEGIN CHART -->
								<div class="pt-1 flex-1">
									<div class="pt-1 mb-1" id="data_analysis_chart" style="width: 100%;"></div>
								</div>
								<!-- END CHART -->
								<!-- BEGIN TABLE -->
								<table class="table">
									<thead class="table-dark">
										<tr>
											<th scope="col"></th>
											<th scope="col">node</th>
											<th scope="col">Location</th>
											<th scope="col">Show</th>
										</tr>
									</thead>
									<tbody>
										{% for node in node_list_supply %}
										<tr>
											<td>
												<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-{{ node.Kwargs }} text-white rounded-2 ms-n1">
													{{ node.Name|make_list|first }}
												</div>
											</td>
											<td>{{ node.Name }}</td>
											<td>{{ node.Region }}</td>
											<td>
												<div class="form-check form-switch">
													<input type="checkbox" class="form-check-input" value='{"name": "{{ node.Name }}", "color": "{{ node.Kwargs }}"}' id="show_da_chart_{{ node.id }}">
												</div>
											</td>
										</tr>
										{% endfor %}
										{% for node in node_list_consumer %}
										<tr>
											<td>
												<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-{{ node.Kwargs }} text-white rounded-2 ms-n1">
													{{ node.Name|make_list|first }}
												</div>
											</td>
											<td>{{ node.Name }}</td>
											<td>{{ node.Region }}</td>
											<td>
												<div class="form-check form-switch">
													<input type="checkbox" class="form-check-input" value='{"name": "{{ node.Name }}", "color": "{{ node.Kwargs }}"}' id="show_da_chart_{{ node.id }}">
												</div>
											</td>
										</tr>
										{% endfor %}
										{% for node in node_list_waste %}
										<tr>
											<td>
												<div id="Status_{{ node.id }}" class="w-20px h-20px d-flex align-items-center justify-content-center bg-gradient-{{ node.Kwargs }} text-white rounded-2 ms-n1">
													{{ node.Name|make_list|first }}
												</div>
											</td>
											<td>{{ node.Name }}</td>
											<td>{{ node.Region }}</td>
											<td>
												<div class="form-check form-switch">
													<input type="checkbox" class="form-check-input" value='{"name": "{{ node.Name }}", "color": "{{ node.Kwargs }}"}' id="show_da_chart_{{ node.id }}">
												</div>
											</td>
										</tr>
										{% endfor %}
									</tbody>
								</table>
								<!-- END TABLE -->
							</div>
							<!-- END TAB-PANE -->

						</div>
						<!-- END tab-content -->						
					</div>
				</div>
			</div>
			<div class="card-arrow">
				<div class="card-arrow-top-left"></div>
				<div class="card-arrow-top-right"></div>
				<div class="card-arrow-bottom-left"></div>
				<div class="card-arrow-bottom-right"></div>
			</div>
		</div>
	</div>
	<!-- END -->


</div>
<!-- END #content -->
{% endblock content %}


<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<script>
	
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	/////////////////////////////////////////////////////////////////// AJAX CALL //////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 
	var markersData = []
	var newMarker = {}
	var icon = ''
	var ajax_call = function() {
		$.ajax({
			type: 'GET',
			url: '../dalys/nodes/list/',
			headers: {
				"Authorization": "Basic " + btoa("admin" + ":" + "will1977"),
				'Accept' : 'application/json'
			},
			success: function(data) {
				
				$.each(data['Data'], function(i, node) {
					// CREATE MAP MARKERS
					if (node.Node_Status == 1) {icon = '/static/assets/img/map/error_marker.png'} else {icon = '/static/assets/img/map/ok_marker.png'}					
					newMarker = {
						location: {
							lat: node.Lat, 
							lng: node.Lng
						},
						tooltip: {
							text: node.Name,
						},
						iconSrc: icon,
					}
					markersData.push(newMarker)					

					// SET STATUS 
					//console.log(node.Name + ': ' + parseInt(Math.abs(new Date()-new Date(node.Last_Updated)) / (1000 * 60)))
					if (parseInt(Math.abs(new Date()-new Date(node.Last_Updated)) / (1000 * 60)) > 2) {
						$('#Node_Status_' + node.id).addClass('bg-danger');
						$('#Node_Status_' + node.id).attr('title', 'Last time data updated was too long.');
						$("#hidden_Node_Status_" + node.id).val('1');
					} else {
						$('#Node_Status_' + node.id).removeClass('bg-danger');
						$("#hidden_Node_Status_" + node.id).val('0');
					}

					// SET VALUES
					set_text(node.id, node.history);

					// SET MAP MARKERS
					set_map_markers(node);

					// SET STATUS MARKERS
					set_status_markers(node);	

				});
				$("#siteMap").dxMap({
					//zoom: 5,
					markers: markersData
				});
			}
		});
	};
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	/////////////////////////////////////////////////////////////////// AJAX CALL //////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 





	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// CREATE TABLES ////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	function create_log_datatable(id) {
		
		// LOG		
		var dataGrid = $('#log2_' + id).dxDataGrid({
			//dataSource: data,
			keyExpr: 'ID',
			showColumnLines: false,
			showRowLines: true,
			rowAlternationEnabled: false,
			showBorders: true,
			paging: {
				pageSize: 8,
			},
			pager: {
				visible: true,
				allowedPageSizes: [5, 10, 'all'],
				showPageSizeSelector: true,
				showInfo: true,
				showNavigationButtons: true,
			},
			columns: [
				{
					title: "DATE TIME",
					dataField: 'Data_DateTime',
				}, {
					title: "L1",
					dataField: 'AppaPower_L1',
					width: 100,
				}, {
					title: "L2",
					dataField: 'AppaPower_L2',
					width: 100,
				}, {
					title: "L3",
					dataField: 'AppaPower_L3',
					width: 100,
				},
			],
		});
	}
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// CREATE TABLES ////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// CREATE CHARTS ////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	function create_charts(id) {
		// CREATE SERIES
		var series = [
			{
				type: 'spline',
				name: 'L1',
				valueField: 'L1',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			},{
				type: 'spline',
				name: 'L2',
				valueField: 'L2',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			},{
				type: 'spline',
				name: 'L3',
				valueField: 'L3',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			}
			//,{
			//	type: 'spline',
			//	name: 'Baseline',
			//	valueField: 'Baseline',
			//	argumentField: "Data_DateTime",
			//	argumentType: "datetime",
			//}
		];
		// CREATE POLAR CHART
		var polar = $('#node_chart_polar_' + id).dxPolarChart({
			palette: 'red',
			commonSeriesSettings: {
				point: {
					visible: false,
				},
			},
			loadingIndicator: {
				enabled: true
			},
			size: {
				height: 300,
			},
			series: [
			{
				type: 'line',
				name: 'L1',
				valueField: 'L1',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			},{
				type: 'line',
				name: 'L2',
				valueField: 'L2',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			},{
				type: 'line',
				name: 'L3',
				valueField: 'L3',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			}//,{
			//	type: 'line',
			//	name: 'Baseline',
			//	valueField: 'Baseline',
			//	argumentField: "Data_DateTime",
			//	argumentType: "datetime",
			//}
		],
			argumentAxis: {
				inverted: false,
				startAngle: 0,
				tickInterval: 'hour',
				period: 'day',
			},
			tooltip: {
				enabled: true,
				shared: true,
				argumentFormat: "shortDateShortTime",
				contentTemplate: function (pointInfo, element) {
					var print = function (label, value) {
						var span = $("<span>", {
							"class": "tooltip-label",
							text: label
						});
						element.append($("<div>", {
							text: value
						}).prepend(span));
					};

					var powerData = {};
					powerData.Data = pointInfo.points[0].point.data;

					print("", powerData.Data.Data_DateTime);
					print("L1: ", powerData.Data.AppaPower_L1.toFixed(3));
					print("L2: ", powerData.Data.AppaPower_L2.toFixed(3));
					print("L3: ", powerData.Data.AppaPower_L3.toFixed(3));
					//print("Baseline: ", powerData.Data.Baseline.toFixed(3));
				},
			},
			legend: {
				verticalAlignment: 'top',
				horizontalAlignment: 'right',
				hoverMode: 'excludePoints',
			}
		});
		// CREATE BAR CHART
		var chart = $('#node_chart_' + id).dxChart({
			palette: 'red',
			commonSeriesSettings: {
				point: {
					visible: false,
				},
			},
			size: {
				height: 360,
			},
			loadingIndicator: {
				enabled: true
			},
			argumentAxis: {
				argumentType: "datetime",
				label: {
					format: "shortDateShortTime"
				},
				valueMarginsEnabled: false,
				discreteAxisDivisionMode: 'crossLabels',
				grid: {
					visible: true,
				},
			},
			series: series,
			tooltip: {
				enabled: true,
			},
			legend: {
				verticalAlignment: 'top',
				horizontalAlignment: 'center',
				hoverMode: 'excludePoints',
			},
			crosshair: {
				enabled: true,
				color: '#949494',
				width: 1,
				dashStyle: 'dot',
				label: {
					visible: true,
					backgroundColor: '#949494',
					font: {
					color: '#fff',
					size: 12,
					},
				},
			},
			export: {
				enabled: false,
			},
			onPointClick: function (e) {
				var point = e.target;
				if (point.isSelected()) {
					point.clearSelection();
				} else {
					point.select();					
				}
			}
		});		
	}
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// CREATE CHARTS ////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// CREATE MAPS ////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// CREATE MAPS
	var renderMaps = function () {
		var siteMap = $('#siteMap').dxMap({
			center: [51.88328620951812, -8.511571884155275],
			zoom: 16.5,
			height: 560,
			width: '100%',
			provider: 'bing',
			controls: true,
			apiKey: {
			// Specify your API keys for each map provider:
			// bing: "YOUR_BING_MAPS_API_KEY",
			},
			type: 'hybrid',
    		markers: markersData,
			mapOnClick: function (e) {
				var point = e.target;
			},
		}).dxMap('instance');
	};
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// CREATE MAPS ////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////





	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// DATA ANALYSYS ////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	$(".nav-link").click(function (event) {
		$("#data_analysis_chart").dxChart('instance').refresh();
	});

	var renderDataAnalysis = function () {
		// RANGE
		var range = $('#data_analysis_range').dxRangeSelector({			
			scale: {
				startValue: new Date(2022, 1, 1),
				endValue: new Date(),
				minorTickInterval: 'day',
				tickInterval: 'week',
				minRange: 'week',
				maxRange: 'month',
				minorTick: {
					visible: false,
				},
			},
			sliderMarker: {
				format: 'monthAndDay',
			},
			value: [new Date(2022, 5, 1), new Date()],
		});
		// CREATE SERIES
		var series = [
			{
				type: 'spline',
				name: 'L1',
				valueField: 'L1',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			},{
				type: 'spline',
				name: 'L2',
				valueField: 'L2',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			},{
				type: 'spline',
				name: 'L3',
				valueField: 'L3',
				argumentField: "Data_DateTime",
				argumentType: "datetime",
			},//{
			//	type: 'spline',
			//	name: 'Baseline',
			//	valueField: 'Baseline',
			//	argumentField: "Data_DateTime",
			//	argumentType: "datetime",
			//}
		];
		// CHART
		var chart = $('#data_analysis_chart').dxChart({
			palette: 'red',
			commonSeriesSettings: {
				point: {
					visible: false,
				},
			},
			size: {
				height: 360,
			},
			loadingIndicator: {
				enabled: true
			},
			argumentAxis: {
				argumentType: "datetime",
				label: {
					format: "shortDateShortTime"
				},
				valueMarginsEnabled: false,
				discreteAxisDivisionMode: 'crossLabels',
				grid: {
					visible: true,
				},
			},
			series: series,
			tooltip: {
				enabled: true,
			},
			legend: {
				verticalAlignment: 'top',
				horizontalAlignment: 'center',
				hoverMode: 'excludePoints',
			},
			crosshair: {
				enabled: true,
				color: '#949494',
				width: 1,
				dashStyle: 'dot',
				label: {
					visible: true,
					backgroundColor: '#949494',
					font: {
					color: '#fff',
					size: 12,
					},
				},
			},
			export: {
				enabled: false,
			},
			onPointClick: function (e) {
				var point = e.target;
				if (point.isSelected()) {
					point.clearSelection();
				} else {
					point.select();					
				}
			}
		});
		// TOOL BAR
		var toolbar = $('#data_analysis_toolbar').dxToolbar({
			items: [
			{
					location: 'before',
					widget: 'dxButton',
					locateInMenu: 'auto',
					options: {
						icon: 'refresh',
						onClick() {
							DevExpress.ui.notify('Refresh button has been clicked!');
						},
					},
				}, {
					location: 'center',
					widget: 'dxSelectBox',
					locateInMenu: 'auto',
					options: {
						items: [
							{
								id: 1,
								text: 'Main Power Supply',
							}, {
								id: 2,
								text: 'Blast Freezer',
							}, {
								id: 3,
								text: 'Main Ward Block',
							}, {
								id: 4,
								text: 'Maternity Basement Node',
							}, {
								id: 5,
								text: 'WasteValue Flume',
							}
						],
						valueExpr: 'id',
						displayExpr: 'text',
						value: 1,
						onValueChanged(args) {
							
						},
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Print',
						onClick() {
							DevExpress.ui.notify('Print option has been clicked!');
						},
					},
				}, {
					locateInMenu: 'always',
					widget: 'dxButton',
					options: {
						text: 'Settings',
						onClick() {
							DevExpress.ui.notify('Settings option has been clicked!');
						},
					},
				},
			],
		});
	};
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// DATA ANALYSYS ////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////














	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// REPORTS //////////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	// TOGGLE PERCENTAGE VS VALUE
	$('#toggle_money_kwh').click({}, function() {
		// UPDATE REPORTING DATA
		change_reporting_data(new Date($('#daterange_reporting').data('daterangepicker').startDate.format()), new Date($('#daterange_reporting').data('daterangepicker').endDate.format()));
	});
	// CHANGE REPORTING DATA
	function change_reporting_data(start, end) {		
		// GET REPORT DATA BY DATE RANGE		
		var data = [];	
		var chart_data = [];
		var supply_total = 0;
		var consumer_total = 0;
		var waste_total = 0;
		
		// LOOP
		$.each(node_list_data, function(i, node) {
			// GET READINGS DATA
			var readings = node.history.filter((item) => item.Data_DateTime.getTime() >= start.getTime() && item.Data_DateTime.getTime() <= end.getTime());

			// GET kW/h
			var rate_day = 0.36;
			var rate_night = 0.25;
			var delta_T = 600/3600;							// Polling interval is 10 min
			var day_start = moment('07:00:00', 'HH:mm:ss');
  			var day_end = moment('23:00:00', 'HH:mm:ss');
			
			var P1_sum = 0;									
			var prev_P1 = 0;								
			var Wh1_day = 0;
			var Wh1_night = 0;

			var P2_sum = 0;									
			var prev_P2 = 0;								
			var Wh2_day = 0;
			var Wh2_night = 0;

			var P3_sum = 0;									
			var prev_P3 = 0;								
			var Wh3_day = 0;
			var Wh3_night = 0;

			//var readings = data.history.filter((item) => item.Data_DateTime.getTime() >= start && item.Data_DateTime.getTime() <= end);		
			
			$.each(readings, function(i, reading) {

				var time = moment(reading.Data_DateTime.toLocaleTimeString([], {hourCycle: 'h23', hour: '2-digit', minute: '2-digit', second: '2-digit'}),'HH:mm:ss');

				if (node.id == 1){
					var P_CT1 = Math.abs(reading.Irms_L1) * Math.abs(reading.Vrms_L1);
					var P_CT2 = Math.abs(reading.Irms_L2) * Math.abs(reading.Vrms_L2);
					var P_CT3 = Math.abs(reading.Irms_L3) * Math.abs(reading.Vrms_L3);
				} else {
					var P_CT1 = Math.abs(reading.AppaPower_L1);
					var P_CT2 = Math.abs(reading.AppaPower_L2);
					var P_CT3 = Math.abs(reading.AppaPower_L3);
				}

				P1_sum = prev_P1 + P_CT1;								
				prev_P1 = P_CT1;							
							
				P2_sum = prev_P2 + P_CT2;								
				prev_P2 = P_CT2;				
							
				P3_sum = prev_P3 + P_CT3;								
				prev_P3 = P_CT3;				

				if (time.isBetween(day_start, day_end)) {
					Wh1_day += delta_T / 2 * P1_sum;
					Wh2_day += delta_T / 2 * P2_sum;
					Wh3_day += delta_T / 2 * P3_sum;
				} else {
					Wh1_night += delta_T / 2 * P1_sum;
					Wh2_night += delta_T / 2 * P2_sum;
					Wh3_night += delta_T / 2 * P3_sum;
				}
			});

			// total
			var kwh_total_day = ((Wh1_day + Wh2_day + Wh3_day) / 1000)
			var kwh_total_night = ((Wh1_night + Wh2_night + Wh3_night) / 1000)
			var kwh_total = kwh_total_day + kwh_total_night;

			// SET TABLE DATA
			if ($("#toggle_money_kwh").not(':checked')) {				
				$("#report_table_value_" + node.id).text('â‚¬ ' + ((kwh_total_day*rate_day)+(kwh_total_night*rate_night)).toFixed(2));
			} else {
				$("#report_table_value_" + node.id).text(kwh_total.toFixed(2) + ' kW/h');
			}			

			// SET VARIABLES AND PUSH TO ARRAY
			console.log(node.Category);
			if (node.Category == 'Power Supply 3 Phase') {
				var supply = kwh_total.toFixed(3);
				supply_total += parseFloat(kwh_total);
			} else if (node.Category == 'Power Consumer 3 Phase') {
				var consumer = kwh_total.toFixed(3);
				consumer_total += parseFloat(kwh_total);
				// CREATE CHART DATA
				chart_data.push({
					ID: node.id, 
					Node: node.Name, 
					Value: kwh_total.toFixed(3),
				});
			}
			// PUSH
			data.push({
				ID: node.id, 
				Node: node.Name, 
				Value: kwh_total.toFixed(3),
			});
		});
		// PUSH NOT nodeED VALUE TO ARRAY
		var not_nodeed = supply_total-consumer_total;
		chart_data.push({
			ID: 0, 
			Node: 'Not Recorded', 
			Value: not_nodeed.toFixed(3),
		})

		console.log(chart_data);
		
		// GET TOGGLE STATUS
		if ($("#toggle_money_kwh").not(':checked')) {
			chart_data = chart_data.map(function(element) {return {'ID': element.ID, 'Node': element.Node, 'Value': ((element.Value/supply_total)*100).toFixed(1)};})
			data = data.map(function(element) {return {'ID': element.ID, 'Node': element.Node, 'Value': ((element.Value/supply_total)*100).toFixed(1)};})
		}
		
		// PIE CHART DATA
		$("#reporting_pie").dxPieChart("option", "dataSource", chart_data);
		$("#reporting_pie").dxPieChart('instance').refresh();
		// BAR CHART DATA
		$("#reporting_bar").dxChart("option", "dataSource", chart_data);
		$("#reporting_bar").dxChart('instance').refresh();
		// TEXT
		$("#report_period").text(((new Date(end).getTime() - new Date(start).getTime()) / (1000 * 3600 * 24)).toFixed(0));
		$("#report_from").text(new Date(start).toDateString());
		$("#report_to").text(new Date(end).toDateString());
		if ($("#toggle_money_kwh").not(':checked')) {
			$("#report_not_nodeed").text(((not_nodeed/supply_total)*100).toFixed(1) + ' %');
			$("#report_waste").text(((waste_total/supply_total)*100).toFixed(1) + ' %');
		} else {
			$("#report_not_nodeed").text(not_nodeed.toFixed(3) + ' kVAr');
			$("#report_waste").text(waste_total.toFixed(3) + ' kVAr');
		}
		// SET TOTALS TEXT
		if ($("#toggle_money_kwh").not(':checked')) {
			$("#report_supply_total_value").text(((supply_total/supply_total)*100).toFixed(1) + ' %');
			$("#report_waste_total_value").text(((waste_total/supply_total)*100).toFixed(1) + ' %');
			$("#report_consumer_total_value").text(((consumer_total/supply_total)*100).toFixed(1) + ' %');
		} else {
			$("#report_supply_total_value").text(supply_total.toFixed(3) + ' kVAr');
			$("#report_waste_total_value").text(waste_total.toFixed(3) + ' kVAr');
			$("#report_consumer_total_value").text(consumer_total.toFixed(3) + ' kVAr');
		}		
	}

	var renderReport = function () {
		// REPORTING REFRESH CHART ON TAB CLICK
		$('#reporting_tab_click').click({}, function() {
			$("#reporting_bar").dxChart('instance').refresh();
			$("#reporting_pie").dxPieChart('instance').refresh();
		});
		// REFRESH CHART
		$('#refresh_reporting').click({}, function() {
			$("#reporting_bar").dxChart('instance').refresh();
			$("#reporting_pie").dxPieChart('instance').refresh();
		});
		// SET CHART SELECTION
		$('#select_chart_type_reporting').change({}, function() {
			//console.log(this.value);
			if (this.value === 'Bar') {
				$("#reporting_bar").show();
				$("#reporting_pie").hide();
			} else if (this.value === 'Pie') {
				$("#reporting_bar").hide();
				$("#reporting_pie").show();
			} 
			$("#reporting_pie").dxPieChart('instance').refresh();
			$("#reporting_bar").dxChart('instance').refresh();
		});
		// SETUP REPORTING DATEPICKER
		$('#daterange_reporting span').html(moment().subtract(24, 'hours').format('DD-MM-YYYY HH:00') + ' - ' + moment().format('DD-MM-YYYY HH:00'));
		$('#daterange_reporting').daterangepicker({
			format: 'MM/DD/YYYY',
			startDate: moment().subtract(24, 'hours'),
			endDate: moment(),
			minDate: moment().subtract(6, 'months'),
			maxDate: moment(),
			dateLimit: { days: 60 },
			showDropdowns: true,
			showWeekNumbers: true,
			timePicker: true,
			timePickerIncrement: 1,
			timePicker12Hour: true,
			ranges: {
				'Today': [moment().startOf('day'), moment()],
				'Last 24 Hours': [moment().subtract(24, 'hours'), moment()],
				'Yesterday': [moment().subtract(1, 'days').startOf('day'), moment().subtract(1, 'days').endOf('day')],
				'Last 7 Days': [moment().subtract(6, 'days').startOf('day'), moment()],
				'This Month So Far': [moment().startOf('month'), moment().endOf('month')],
				'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')],
				'This Year So Far': [moment().startOf('year'), moment().endOf('year')],
				'Last Year': [moment().subtract(1, 'year').startOf('year'), moment().subtract(1, 'year').endOf('year')]
			},
			opens: 'right',
			drops: 'down',
			buttonClasses: ['btn', 'btn-sm'],
			applyClass: 'btn-primary',
			cancelClass: 'btn-default',
			separator: ' to ',
			locale: {
				applyLabel: 'Submit',
				cancelLabel: 'Cancel',
				fromLabel: 'From',
				toLabel: 'To',
				customRangeLabel: 'Custom',
				daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr','Sa'],
				monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
				firstDay: 1
			}
		}, function(start, end, label) {
			$('#daterange_reporting span').html(start.format('DD-MM-YYYY HH:00') + ' - ' + end.format('DD-MM-YYYY HH:00'));
			change_reporting_data(new Date(start.format()), new Date(end.format()));
		});		
		// PIE CHART
		var piechart = $('#reporting_pie').dxPieChart({
			palette: 'red',
			//dataSource: data,
			legend: {
				horizontalAlignment: 'center',
				verticalAlignment: 'bottom',
			},
			series: [{
				argumentField: 'Node',
				valueField: 'Value',
				label: {
					visible: true,
					connector: {
						visible: true,
						width: 0.5,
					},
					format: 'fixedPoint',
					customizeText(point) {
						// SET PREFIX
						var prefix = ' kVAr';
						if ($("#toggle_money_kwh").not(':checked')) {
							prefix = ' %';
						} else {
							prefix = ' kVAr';
						}
						return `${point.value} ` + prefix;
					},
				},
			}],
		});
		// BAR CHART
		var barChart = $('#reporting_bar').dxChart({
			//dataSource: data,
			palette: 'red',
			commonSeriesSettings: {
				type: 'bar',
				valueField: 'Value',
				argumentField: 'Node',
				ignoreEmptyPoints: true,
			},
			rotated: true,
			seriesTemplate: {
				nameField: 'Node',
			},
		});
		// CHANGE REPORT CHART TYPE
		function change_reporting_chart_type(item) {
			if (item.name == 'Bar') {
				$("#reporting_pie").hide();
				$("#reporting_bar").show();
			} else if (item.name == 'Pie') {
				$("#reporting_pie").show();
				$("#reporting_bar").hide();
			}
		};
		// SET REPORTING DATA
		$("#reporting_pie").show();
		$("#reporting_bar").hide();
		change_reporting_data(new Date(moment().subtract(24, 'hours').format()), new Date(moment().format()));
	};
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// REPORTS //////////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	









	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// SETUP //////////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// SET UP PAGE, CREATE ALL CONTROLS
	function page_setup() {
		// CREATE
		$.each(node_list_data, function(i, node) {
			// CREATE CHARTS
			create_charts(node.id);
			$("#node_chart_" + node.id).show();
			$("#node_chart_polar_" + node.id).hide();
			// CREATE LOG TABLE
			create_log_datatable(node.id);			
			// CREATE NODE TOOL BAR
			create_node_tool_bars(node);
		});
		// CREATE MAP
		renderMaps();
	}
	// CREATE TOOL BARS BY ID
	function create_node_tool_bars(node) {
		// REFRESH CHART
		$('#refresh_' + node.id).click({}, function() {
			$("#node_chart_" + node.id).dxChart('instance').refresh();
			$("#node_chart_polar_" + node.id).dxPolarChart('instance').refresh();
		});
		// REFRESH CHART ON SLIDER CLICK
		$('#slider_' + node.id).click({}, function() {
			$("#node_chart_" + node.id).dxChart('instance').refresh();
			$("#node_chart_polar_" + node.id).dxPolarChart('instance').refresh();
		});
		// SET CHART SELECTION
		$('#select_chart_type_' + node.id).change({}, function() {
			//console.log(this.value);
			if (this.value === 'Bar') {
				$("#node_chart_" + node.id).show();
				$("#node_chart_polar_" + node.id).hide();
			} else if (this.value === 'Polar') {
				$("#node_chart_" + node.id).hide();
				$("#node_chart_polar_" + node.id).show();
			}
			$("#node_chart_" + node.id).dxChart('instance').refresh();
			$("#node_chart_polar_" + node.id).dxPolarChart('instance').refresh();
		});
		// SETUP DATEPICKER
		$('#daterange_' + node.id + ' span').html(moment().subtract(24, 'hours').format('DD-MM-YYYY HH:00') + ' - ' + moment().format('DD-MM-YYYY HH:00'));
		$('#daterange_' + node.id).daterangepicker({
			format: 'MM/DD/YYYY',
			startDate: moment().subtract(24, 'hours'),
			endDate: moment(),
			minDate: moment().subtract(6, 'months'),
			maxDate: moment(),
			dateLimit: { days: 60 },
			showDropdowns: true,
			showWeekNumbers: true,
			timePicker: true,
			timePickerIncrement: 1,
			timePicker12Hour: true,
			ranges: {
				'Today': [moment().startOf('day'), moment()],
				'Last 24 Hours': [moment().subtract(24, 'hours'), moment()],
				'Yesterday': [moment().subtract(1, 'days').startOf('day'), moment().subtract(1, 'days').endOf('day')],
				'Last 7 Days': [moment().subtract(6, 'days').startOf('day'), moment()],
				'This Month So Far': [moment().startOf('month'), moment().endOf('month')],
				'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')],
				'This Year So Far': [moment().startOf('year'), moment().endOf('year')],
				'Last Year': [moment().subtract(1, 'year').startOf('year'), moment().subtract(1, 'year').endOf('year')]
			},
			opens: 'right',
			drops: 'down',
			buttonClasses: ['btn', 'btn-sm'],
			applyClass: 'btn-primary',
			cancelClass: 'btn-default',
			separator: ' to ',
			locale: {
				applyLabel: 'Submit',
				cancelLabel: 'Cancel',
				fromLabel: 'From',
				toLabel: 'To',
				customRangeLabel: 'Custom',
				daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr','Sa'],
				monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
				firstDay: 1
			}
		}, function(start, end, label) {
			$('#daterange_' + node.id + ' span').html(start.format('DD-MM-YYYY HH:00') + ' - ' + end.format('DD-MM-YYYY HH:00'));
			change_chart_data(node.id, new Date(start.format()), new Date(end.format()));
		});
	}
	// SET UP PAGE, CREATE ALL CONTROLS
	function data_setup() {
		// CREATE
		$.each(node_list_data, function(i, node) {
			// READINGS
			var readings = [];
			// GENERATE DATA
			var start = new Date(moment().subtract(24, 'hours').format());
			var end =  new Date(moment().format());			
			var readings = node.history.filter((item) => item.Data_DateTime.getTime() >= start.getTime() && item.Data_DateTime.getTime() <= end.getTime());
			var pulseSum = 0;
			$.each(readings, function(i, reading) {
				pulseSum += reading.Pulses
			});

			// SET CHART DATA
			$("#node_chart_" + node.id).dxChart("option", "dataSource", readings.map(function(element) {return {'Data_DateTime': element.Data_DateTime, 'L1': Math.abs(element.RealPower_L1), 'L2': Math.abs(element.RealPower_L2), 'L3': Math.abs(element.RealPower_L3)};}));
			$("#node_chart_" + node.id).dxChart('instance').refresh();
			// SET POLAR CHART DATA
			$("#node_chart_polar_" + node.id).dxPolarChart("option", "dataSource", readings.map(function(element) {return {'Data_DateTime': element.Data_DateTime, 'L1': Math.abs(element.RealPower_L1), 'L2': Math.abs(element.RealPower_L2), 'L3': Math.abs(element.RealPower_L3)};}));
			$("#node_chart_polar_" + node.id).dxPolarChart('instance').refresh();
			// SET LOG VALUES
			$("#log2_" + node.id).dxDataGrid("option", "dataSource", readings.map(function(element) {return {'ID': element.id, 'Data_DateTime': element.Data_DateTime, 'L1': Math.abs(element.RealPower_L1), 'L2': Math.abs(element.RealPower_L2), 'L3': Math.abs(element.RealPower_L3)};}));
			$("#log2_" + node.id).dxDataGrid('instance').refresh();
			// SET CHART DATA
			$("#data_analysis_chart").dxChart("option", "dataSource", readings.map(function(element) {return {'Data_DateTime': element.Data_DateTime, 'L1': Math.abs(element.RealPower_L1), 'L2': Math.abs(element.RealPower_L2), 'L3': Math.abs(element.RealPower_L3)};}));
			$("#data_analysis_chart").dxChart('instance').refresh();

			// SET VALUES
			set_text(node.id, node, new Date(moment().subtract(24, 'hours').format()).getTime(), new Date(moment().format()).getTime());
			// SET MAP MARKERS
			set_map_markers(node);
			// SET STATUS MARKERS
			set_status_markers(node);
		});
		// PUSH MAP MARKERS
		$("#siteMap").dxMap({
			//zoom: 5,
			markers: markersData
		});
	}
	// CHANGE CHART DATA
	function change_chart_data(id, start, end) {

		var readings = [];

		$.each(node_list_data, function(i, node) {
			if (node.id == id) {

				var readings = node.history.filter((item) => item.Data_DateTime.getTime() >= start.getTime() && item.Data_DateTime.getTime() <= end.getTime());

				var pulseSum = 0;
				$.each(readings, function(i, reading) {
					pulseSum += reading.Pulses
				});				
				
				// SET CHART DATA
				$("#node_chart_" + node.id).dxChart("option", "dataSource", readings.map(function(element) {return {'Data_DateTime': element.Data_DateTime, 'L1': Math.abs(element.RealPower_L1), 'L2': Math.abs(element.RealPower_L2), 'L3': Math.abs(element.RealPower_L3)};}));
				$("#node_chart_" + node.id).dxChart('instance').refresh();
				// SET POLAR CHART DATA
				$("#node_chart_polar_" + node.id).dxPolarChart("option", "dataSource", readings.map(function(element) {return {'Data_DateTime': element.Data_DateTime, 'L1': Math.abs(element.RealPower_L1), 'L2': Math.abs(element.RealPower_L2), 'L3': Math.abs(element.RealPower_L3)};}));
				$("#node_chart_polar_" + node.id).dxPolarChart('instance').refresh();
				// SET LOG VALUES
				$("#log2_" + node.id).dxDataGrid("option", "dataSource", readings.map(function(element) {return {'ID': element.id, 'Data_DateTime': element.Data_DateTime, 'L1': Math.abs(element.RealPower_L1), 'L2': Math.abs(element.RealPower_L2), 'L3': Math.abs(element.RealPower_L3)};}));
				$("#log2_" + node.id).dxDataGrid('instance').refresh();
				// SET CHART DATA
				$("#data_analysis_chart").dxChart("option", "dataSource", readings.map(function(element) {return {'Data_DateTime': element.Data_DateTime, 'L1': Math.abs(element.RealPower_L1), 'L2': Math.abs(element.RealPower_L2), 'L3': Math.abs(element.RealPower_L3)};}));
				$("#data_analysis_chart").dxChart('instance').refresh();

				// SET VALUES
				set_text(node.id, node, start, end);
			}			
		});		
	}
	// set page text
	function set_text(id, data, start, end) {

		// GET kW/h
		var rate_day = 0.36;
		var rate_night = 0.25;
		var delta_T = 600/3600;							// Polling interval is 10 min
		var day_start = moment('07:00:00', 'HH:mm:ss');
  		var day_end = moment('23:00:00', 'HH:mm:ss');
		
		var P1_sum = 0;									
		var prev_P1 = 0;								
		var Wh1_day = 0;
		var Wh1_night = 0;

		var P2_sum = 0;									
		var prev_P2 = 0;								
		var Wh2_day = 0;
		var Wh2_night = 0;

		var P3_sum = 0;									
		var prev_P3 = 0;								
		var Wh3_day = 0;
		var Wh3_night = 0;

		var readings = data.history.filter((item) => item.Data_DateTime.getTime() >= start && item.Data_DateTime.getTime() <= end);		
		
		$.each(readings, function(i, reading) {

			var time = moment(reading.Data_DateTime.toLocaleTimeString([], {hourCycle: 'h23', hour: '2-digit', minute: '2-digit', second: '2-digit'}),'HH:mm:ss');

			if (id == 1){
				var P_CT1 = Math.abs(reading.Irms_L1) * Math.abs(reading.Vrms_L1);
				var P_CT2 = Math.abs(reading.Irms_L2) * Math.abs(reading.Vrms_L2);
				var P_CT3 = Math.abs(reading.Irms_L3) * Math.abs(reading.Vrms_L3);
			} else {
				var P_CT1 = Math.abs(reading.AppaPower_L1);
				var P_CT2 = Math.abs(reading.AppaPower_L2);
				var P_CT3 = Math.abs(reading.AppaPower_L3);
			}

			P1_sum = prev_P1 + P_CT1;								
			prev_P1 = P_CT1;		
						
			P2_sum = prev_P2 + P_CT2;								
			prev_P2 = P_CT2;
						
			P3_sum = prev_P3 + P_CT3;								
			prev_P3 = P_CT3;

			if (time.isBetween(day_start, day_end)) {
				Wh1_day += delta_T / 2 * P1_sum;
				Wh2_day += delta_T / 2 * P2_sum;
				Wh3_day += delta_T / 2 * P3_sum;
			} else {
				Wh1_night += delta_T / 2 * P1_sum;
				Wh2_night += delta_T / 2 * P2_sum;
				Wh3_night += delta_T / 2 * P3_sum;
			}
		});

		// total
		var kwh_total_day = ((Wh1_day + Wh2_day + Wh3_day) / 1000)
		var kwh_total_night = ((Wh1_night + Wh2_night + Wh3_night) / 1000)
		var kwh_total = kwh_total_day + kwh_total_night;

		// kW/h
		$("#total_kwh_value_" + id).text(kwh_total.toFixed(2));
		$("#total_kwh_bar_" + id).attr('style', 'width: ' + getPercentage(kwh_total, 600).toFixed(0) + '%');
		$("#total_kwh_info_" + id).text('@ ' + getPercentage(kwh_total, 600).toFixed(0) + '% of 600 kW.');
		$("#total_kwh_day_" + id).text('Day: ' + (kwh_total_day).toFixed(2) + 'kVAr');
		$("#total_kwh_night_" + id).text('Night: ' + (kwh_total_night).toFixed(2) + 'kVAr');
		// real power
		var rp_total = (Math.abs(data.RealPower_L1) + Math.abs(data.RealPower_L2) + Math.abs(data.RealPower_L3)) / 1000
		$("#value_main_" + id).text(rp_total.toFixed(3));
		$("#real_power_value_" + id).text(rp_total.toFixed(2));
		$("#real_power_bar_" + id).attr('style', 'width: ' + getPercentage(rp_total, 600).toFixed(0) + '%');		
		// current
		var irms_total = (Math.abs(data.Irms_L1) + Math.abs(data.Irms_L2) + Math.abs(data.Irms_L3))
		$("#irms_value_" + id).text(irms_total.toFixed(2));
		$("#irms_bar_" + id).attr('style', 'width: ' + getPercentage(irms_total, 600).toFixed(0) + '%');
		$("#irms_info_" + id).text('@ ' + getPercentage(irms_total, 600).toFixed(0) + '% of 600 A.');
		// cost
		var total_cost = (kwh_total_day*rate_day) + (kwh_total_night*rate_night)
		$("#cost_value_" + id).text(total_cost.toFixed(2));
		$("#cost_bar_" + id).attr('style', 'width: ' + getPercentage(total_cost, 250).toFixed(0) + '%');
		$("#cost_day_" + id).text('Day Cost: â‚¬' + (kwh_total_day*rate_day).toFixed(2));
		$("#cost_night_" + id).text('Night Cost: â‚¬' + (kwh_total_night*rate_night).toFixed(2));
	}
	// percentage function
	function getPercentage(act, max) {
		return (act / max) * 100;
	}
	// SET STATUS MARKERS
	function set_status_markers(node) {
		//console.log(node.Name + ': ' + parseInt(Math.abs(new Date()-new Date(node.Last_Updated)) / (1000 * 60)))
		if (parseInt(Math.abs(new Date()-new Date(node.Last_Updated)) / (1000 * 60)) > 2) {
			$('#Node_Status_' + node.id).addClass('bg-danger');
			$('#Node_Status_' + node.id).attr('title', 'Last time data updated was too long.');
			$("#hidden_Node_Status_" + node.id).val('1');
		} else {
			$('#Node_Status_' + node.id).removeClass('bg-danger');
			$("#hidden_Node_Status_" + node.id).val('0');
		}
	}
	// SET MAP MARKERS
	function set_map_markers(node) {
		if (node.Node_Status == 1) {icon = '/static/assets/img/map/error_marker.png'} else {icon = '/static/assets/img/map/ok_marker.png'}					
		newMarker = {
			location: {
				lat: node.Lat, 
				lng: node.Lng
			},
			tooltip: {
				text: node.Name,
			},
			iconSrc: icon,
		}
		markersData.push(newMarker)			
	}
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// SETUP //////////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////





	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// WESOCKET //////////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// wesocket
	var startWebSocket = function () {
		var autosondeSocket;
		var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
		var ws_path = ws_scheme + '://' + window.location.host + ':8001/dalys/';
		var ws_path = 'wss://www.enviroscan.io:8001/dalys/';
		console.log(ws_path)
		autosondeSocket = new WebSocket(ws_path);    

		autosondeSocket.onmessage = function (e) {
			json_data = JSON.parse(e.data).message;
			console.log(json_data);
			// process node
			//process_node(json_data.Node_ID, json_data)
			//set_text(json_data.Node_ID, json_data);
			
		};

		autosondeSocket.onclose = function (e) {
			console.log('Socket is closed. Reconnect will be attempted in 1 second.', e.reason);
		};

		autosondeSocket.onerror = function (err) {
			console.error(err);
		};
	};
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// WESOCKET /////////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// GET MAIN DATA ////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// GET DATA
	function reviver_1(key, value) {
		if (key === 'Data_DateTime' || key === 'Start_Date') {
			return new Date(value);
		}
		if (key === 'history' || key === 'logs') {
			JSON.parse(JSON.stringify(value), reviver_2);
		}
		return value;
	}
	// GET DATA
	function reviver_2(key, value) {
		if (key === 'Data_DateTime') {
			return new Date(value);
		}
		return value;
	}
	// GET DATA
	var node_list_data = JSON.parse('{{node_list_data|escapejs}}', reviver_1).Data;
	console.log(node_list_data);
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// GET MAIN DATA ////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// CONTROLLER ////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	/* Controller
	------------------------------------------------ */
	$(document).ready(function () {	
		
		page_setup();

		//ajax_call();
		renderReport();
		renderDataAnalysis();
		data_setup();
		startWebSocket();		
		
		//var interval_status = 60000; // 60 secs
		//setInterval(ajax_call, interval_status);

		$(document).on('theme-reload', function () {
			//ajax_call();
		});

	});
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////// CONTROLLER ////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

</script>
{% endblock javascripts %}